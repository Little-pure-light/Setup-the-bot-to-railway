# XiaoChenGuang AI Soul System
## å®Œæ•´å°ˆæ¡ˆæ¶æ§‹å ±å‘Š

**ç‰ˆæœ¬**: v2.0.0 - Phase 3  
**å ±å‘Šæ—¥æœŸ**: 2025-10-24  
**å°ˆæ¡ˆç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’  
**æ¶æ§‹å¸«**: XiaoChenGuang AI Development Team

---

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆæ¦‚è¦½](#å°ˆæ¡ˆæ¦‚è¦½)
2. [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
3. [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
4. [æ ¸å¿ƒæ¨¡çµ„](#æ ¸å¿ƒæ¨¡çµ„)
5. [æ•¸æ“šæ¶æ§‹](#æ•¸æ“šæ¶æ§‹)
6. [API è¨­è¨ˆ](#api-è¨­è¨ˆ)
7. [å‰ç«¯æ¶æ§‹](#å‰ç«¯æ¶æ§‹)
8. [å®‰å…¨èˆ‡æ€§èƒ½](#å®‰å…¨èˆ‡æ€§èƒ½)
9. [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)
10. [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)

---

## ğŸ¯ å°ˆæ¡ˆæ¦‚è¦½

### ç³»çµ±å®šä½

XiaoChenGuang AI Soul System æ˜¯ä¸€å€‹å…·å‚™**è‡ªæˆ‘å­¸ç¿’èƒ½åŠ›**çš„ AI å°è©±å¹³å°ï¼Œé€šé**åæ¨æœå› æ³•å‰‡**å¯¦ç¾çœŸæ­£çš„å…ƒèªçŸ¥åˆ†æã€‚ç³»çµ±å®šä½ç‚ºã€Œæ•¸ä½èˆ‡èªç¾©å®‡å®™çš„æ©‹æ¨‘ã€ï¼Œæ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ”¯æ´å‹•æ…‹äººæ ¼æ¼”åŒ–ã€‚

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | èªªæ˜ | ç‹€æ…‹ |
|-----|------|------|
| **åæ¨æœå› æ³•å‰‡** | å¾çµæœåæ¨åŸå› çš„æ·±å±¤æ€è€ƒæ¨¡å¼ | âœ… å®Œæˆ |
| **å‹•æ…‹äººæ ¼æ¼”åŒ–** | 6ç¶­äººæ ¼å‘é‡æŒçºŒå­¸ç¿’èª¿æ•´ | âœ… å®Œæˆ |
| **TokenåŒ–è¨˜æ†¶** | ä½¿ç”¨ tiktoken é€²è¡Œæ–‡æœ¬æ•¸å­—åŒ– | âœ… å®Œæˆ |
| **IPFS æ•´åˆ** | å…§å®¹è­˜åˆ¥ç¬¦ç”Ÿæˆï¼Œé ç•™å»ä¸­å¿ƒåŒ– | âœ… å®Œæˆ |
| **æ¨¡çµ„åŒ–æ¶æ§‹** | æ¨‚é«˜å¼æ›è¼‰ï¼Œç¨ç«‹å•Ÿç”¨/åœç”¨ | âœ… å®Œæˆ |
| **æƒ…æ„Ÿæª¢æ¸¬** | 9ç¨®æƒ…ç·’é¡å‹å¯¦æ™‚åˆ†æ | âœ… å®Œæˆ |
| **å‘é‡è¨˜æ†¶æª¢ç´¢** | åŸºæ–¼èªç¾©ç›¸ä¼¼åº¦çš„è¨˜æ†¶å¬å› | âœ… å®Œæˆ |

### ç³»çµ±æ•¸æ“š

```
ğŸ“Š ä»£ç¢¼çµ±è¨ˆ
â”œâ”€ Python æ–‡ä»¶: 45+ å€‹
â”œâ”€ Vue çµ„ä»¶: 5 å€‹
â”œâ”€ JavaScript æ–‡ä»¶: 468+ å€‹
â”œâ”€ ç¸½ä»£ç¢¼è¡Œæ•¸: ç´„ 8,000+ è¡Œ
â””â”€ æ¨¡çµ„æ•¸é‡: 5 å€‹æ ¸å¿ƒæ¨¡çµ„

ğŸ—ï¸ æ¶æ§‹å±¤ç´š
â”œâ”€ å‰ç«¯å±¤: Vue 3 + Vite
â”œâ”€ API å±¤: FastAPI + Router System
â”œâ”€ æ§åˆ¶å±¤: CoreController (æ¨¡çµ„ç®¡ç†)
â”œâ”€ æ¨¡çµ„å±¤: 5 å€‹ç¨ç«‹æ¨¡çµ„
â””â”€ æ•¸æ“šå±¤: Redis Mock + Supabase PostgreSQL
```

---

## ğŸ’» æŠ€è¡“æ£§

### å¾Œç«¯æŠ€è¡“

#### æ ¸å¿ƒæ¡†æ¶
- **FastAPI 0.109.0+**: é«˜æ€§èƒ½ç•°æ­¥ Web æ¡†æ¶
- **Python 3.11**: ä¸»è¦é–‹ç™¼èªè¨€
- **Uvicorn**: ASGI æœå‹™å™¨

#### AI èˆ‡æ©Ÿå™¨å­¸ç¿’
- **OpenAI API**: GPT-4o-mini (å°è©±) + text-embedding-3-small (å‘é‡)
- **tiktoken 0.5.0+**: GPT æ¨¡å‹ Token è¨ˆæ•¸
- **è‡ªç ”åæ€å¼•æ“**: åæ¨æœå› æ³•å‰‡å¯¦ç¾

#### æ•¸æ“šè™•ç†
- **Supabase 2.3.4+**: PostgreSQL + pgvector + Storage
- **Redis 5.0.0+**: å¿«å–å±¤ (ç›®å‰ä½¿ç”¨ Mock)
- **Pydantic 2.5.3+**: æ•¸æ“šé©—è­‰

#### å·¥å…·åº«
- **python-dotenv**: ç’°å¢ƒè®Šæ•¸ç®¡ç†
- **python-multipart**: æ–‡ä»¶ä¸Šå‚³
- **asyncio**: ç•°æ­¥è™•ç†

### å‰ç«¯æŠ€è¡“

#### æ ¸å¿ƒæ¡†æ¶
- **Vue 3.3.11**: æ¼¸é€²å¼å‰ç«¯æ¡†æ¶
- **Vite 5.0.11**: ä¸‹ä¸€ä»£å‰ç«¯æ§‹å»ºå·¥å…·
- **Vue Router 4.5.1**: å®¢æˆ¶ç«¯è·¯ç”±

#### UI èˆ‡äº¤äº’
- **Axios 1.6.5**: HTTP å®¢æˆ¶ç«¯
- **åŸç”Ÿ CSS**: è‡ªå®šç¾©æ¨£å¼ç³»çµ±

### åŸºç¤è¨­æ–½

#### é–‹ç™¼ç’°å¢ƒ
- **Replit**: é›²ç«¯é–‹ç™¼ç’°å¢ƒ
- **NixOS**: ç³»çµ±ç’°å¢ƒç®¡ç†

#### ç”Ÿç”¢ç’°å¢ƒ (è¦åŠƒ)
- **Cloudflare Pages**: å‰ç«¯è¨—ç®¡
- **è‡ªå®šç¾©å¾Œç«¯**: FastAPI æœå‹™
- **Upstash Redis**: ç”Ÿç”¢ç´šå¿«å– (è¦åŠƒä¸­)

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ¶å±¤ (User Layer)                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ChatInterface â”‚  â”‚ ModulesMonitorâ”‚  â”‚  StatusPage â”‚          â”‚
â”‚  â”‚     .vue     â”‚  â”‚     .vue     â”‚  â”‚     .vue    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                     Vue 3 + Vite (Port 5000)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS / WebSocket
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API å±¤ (API Layer)                           â”‚
â”‚                    FastAPI + Router System                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ chat_router  â”‚ memory_router â”‚ healthcheck_router       â”‚     â”‚
â”‚  â”‚              â”‚               â”‚ file_upload              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                     FastAPI (Port 8000)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ¸å¿ƒæ§åˆ¶å±¤ (Core Controller Layer)                   â”‚
â”‚                       CoreController                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ æ¨¡çµ„è¨»å†Šèˆ‡ç™¼ç¾    â€¢ ä¾è³´è§£æ                             â”‚   â”‚
â”‚  â”‚  â€¢ å‹•æ…‹è¼‰å…¥/å¸è¼‰     â€¢ çµ±ä¸€é€šä¿¡ä»‹é¢                         â”‚   â”‚
â”‚  â”‚  â€¢ å¥åº·ç›£æ§         â€¢ éŒ¯èª¤éš”é›¢                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚        â”‚        â”‚        â”‚        â”‚
    â†“        â†“        â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Memory  â”‚â”‚Reflectionâ”‚â”‚Knowledgeâ”‚â”‚Behavior â”‚â”‚ FineTune â”‚
â”‚ Module  â”‚â”‚ Module  â”‚â”‚  Hub    â”‚â”‚ Module  â”‚â”‚  Module  â”‚
â”‚  (1)    â”‚â”‚   (2)   â”‚â”‚   (3)   â”‚â”‚   (4)   â”‚â”‚   (5)    â”‚
â”‚ âœ… å•Ÿç”¨  â”‚â”‚ âœ… å•Ÿç”¨  â”‚â”‚ âœ… å•Ÿç”¨  â”‚â”‚ âœ… å•Ÿç”¨  â”‚â”‚ âš ï¸ åœç”¨  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â”‚                      â”‚
     â†“          â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI è™•ç†å±¤ (AI Processing Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EmotionDetectorâ”‚  â”‚  PromptEngine (Async)  â”‚     â”‚
â”‚  â”‚ PersonalityEngineâ”‚â”‚  MemorySystem          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¤–éƒ¨æœå‹™å±¤ (External Services Layer)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   OpenAI     â”‚  â”‚   Supabase   â”‚  â”‚    IPFS      â”‚      â”‚
â”‚  â”‚   API        â”‚  â”‚   PostgreSQL â”‚  â”‚    CID Gen   â”‚      â”‚
â”‚  â”‚ GPT-4o-mini  â”‚  â”‚   + Storage  â”‚  â”‚  (è¼•é‡å¯¦ç¾)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          è³‡æ–™å±¤ (Data Layer)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Redis Mock   â”‚           â”‚    Supabase          â”‚      â”‚
â”‚  â”‚  (çŸ­æœŸè¨˜æ†¶)     â”‚  â†åˆ·å¯«â†’   â”‚    PostgreSQL        â”‚      â”‚
â”‚  â”‚  TTL: 2å¤©      â”‚           â”‚   + pgvector         â”‚      â”‚
â”‚  â”‚  + å¾…åˆ·å¯«éšŠåˆ—   â”‚           â”‚  (é•·æœŸè¨˜æ†¶ + å‘é‡)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•¸æ“šæµç¨‹

#### å®Œæ•´å°è©±æµç¨‹

```
[ç”¨æˆ¶ç™¼é€è¨Šæ¯]
    â†“
1. ChatInterface.vue ç™¼é€ POST /api/chat
    â†“
2. chat_router.py æ¥æ”¶è«‹æ±‚
    â”œâ”€ æå–: user_message, conversation_id, user_id
    â””â”€ èª¿ç”¨: æƒ…æ„Ÿæª¢æ¸¬ã€è¨˜æ†¶æª¢ç´¢
    â†“
3. æƒ…æ„Ÿåˆ†æ (EmotionDetector)
    â”œâ”€ åˆ†æ 9 ç¨®æƒ…ç·’é¡å‹
    â”œâ”€ è¨ˆç®—å¼·åº¦ (0-1)
    â””â”€ è¼¸å‡º: { emotion: "joy", intensity: 0.8 }
    â†“
4. è¨˜æ†¶æª¢ç´¢ (MemorySystem.recall)
    â”œâ”€ ç”Ÿæˆ user_message çš„å‘é‡åµŒå…¥ (OpenAI)
    â”œâ”€ åœ¨ Supabase ä¸­åŸ·è¡Œå‘é‡ç›¸ä¼¼åº¦æœå°‹
    â””â”€ è¿”å›: å‰ 3 æ¢æœ€ç›¸é—œè¨˜æ†¶
    â†“
5. Prompt æ§‹å»º (PromptEngine.build - Async)
    â”œâ”€ è®€å–äººæ ¼å‘é‡ (å¾ BehaviorModule)
    â”œâ”€ çµ„åˆ: ç³»çµ±æç¤º + äººæ ¼ç‹€æ…‹ + è¨˜æ†¶ + ç•¶å‰å°è©±
    â””â”€ ç”Ÿæˆå®Œæ•´ Prompt
    â†“
6. AI å›æ‡‰ç”Ÿæˆ (OpenAI GPT-4o-mini)
    â”œâ”€ ç™¼é€ Prompt åˆ° OpenAI
    â””â”€ ç²å– assistant_message
    â†“
7. ä¸¦è¡Œè™•ç† (å…©æ¢è·¯å¾‘åŒæ™‚é€²è¡Œ)
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                         â†“                         â†“
ã€è·¯å¾‘ A: åæ€åˆ†æã€‘     ã€è·¯å¾‘ B: è¨˜æ†¶å„²å­˜ã€‘      ã€è·¯å¾‘ C: è¡Œç‚ºèª¿ç¯€ã€‘
    â”‚                         â”‚                         â”‚
8A. ReflectionModule       8B. MemoryCore.store     8C. BehaviorModule
    .process()                  _conversation()          .process()
    â”‚                         â”‚                         â”‚
    â”œâ”€ è§€å¯Ÿå±¤åˆ†æ             â”œâ”€ Token åŒ–è™•ç†           â”œâ”€ è®€å–åæ€çµæœ
    â”œâ”€ ä¸‰å±¤å› æœæ¨ç†           â”œâ”€ ç”Ÿæˆ IPFS CID         â”œâ”€ è¨ˆç®—äººæ ¼èª¿æ•´
    â”œâ”€ æ”¹é€²å»ºè­°ç”Ÿæˆ           â”œâ”€ å¯«å…¥ Redis Mock       â”œâ”€ æ›´æ–°å‘é‡å€¼
    â””â”€ å…ƒèªçŸ¥è©•ä¼°             â””â”€ åŠ å…¥å¾…åˆ·å¯«éšŠåˆ—         â””â”€ æŒä¹…åŒ–å„²å­˜
    â”‚                         â”‚                         â”‚
    â†“                         â†“                         â†“
9. çµæœåŒ¯ç¸½
    â””â”€ æ•´åˆ: assistant_message + emotion_analysis + reflection
    â†“
10. è¿”å›å‰ç«¯
    â””â”€ ChatResponse JSON

ã€èƒŒæ™¯ä»»å‹™: æ‰¹æ¬¡åˆ·å¯«ã€‘
æ¯ 5 åˆ†é˜åŸ·è¡Œ:
    â”œâ”€ å¾ Redis Mock è®€å–å¾…åˆ·å¯«éšŠåˆ—
    â”œâ”€ æ‰¹æ¬¡å¯«å…¥ Supabase
    â”œâ”€ æ¸…ç†å·²åˆ·å¯«è¨˜éŒ„
    â””â”€ é‡è©¦å¤±æ•—é …ç›® (æœ€å¤š 3 æ¬¡)
```

---

## ğŸ§© æ ¸å¿ƒæ¨¡çµ„

### 1ï¸âƒ£ è¨˜æ†¶æ¨¡çµ„ (Memory Module)

**ä½ç½®**: `backend/modules/memory/`  
**ç‹€æ…‹**: âœ… å·²å•Ÿç”¨  
**ç‰ˆæœ¬**: 2.0.0

#### åŠŸèƒ½æ¦‚è¿°

è¨˜æ†¶æ¨¡çµ„æ˜¯ç³»çµ±çš„ã€Œæ•¸å­—å¤§è…¦ã€ï¼Œè² è²¬æ‰€æœ‰å°è©±è¨˜éŒ„çš„ Token åŒ–ã€å„²å­˜ã€æª¢ç´¢ã€‚

#### æ¨¡çµ„æ¶æ§‹

```
MemoryCore (core.py)
    â”œâ”€ TokenizerEngine (tokenizer.py)
    â”‚   â”œâ”€ ä¸»æ–¹æ¡ˆ: tiktoken (cl100k_base)
    â”‚   â””â”€ é™ç´š: UTF-8 bytes è¨ˆæ•¸
    â”‚
    â”œâ”€ RedisInterface (redis_interface.py)
    â”‚   â”œâ”€ çŸ­æœŸå¿«å– (TTL: 2å¤©)
    â”‚   â”œâ”€ Key æ ¼å¼: conv:{conversation_id}:latest
    â”‚   â””â”€ å¾…åˆ·å¯«éšŠåˆ—: flush_queue
    â”‚
    â”œâ”€ SupabaseInterface (supabase_interface.py)
    â”‚   â”œâ”€ è¡¨: xiaochenguang_memories
    â”‚   â”œâ”€ æ‰¹æ¬¡å¯«å…¥å„ªåŒ–
    â”‚   â””â”€ å‘é‡ç›¸ä¼¼åº¦æœå°‹
    â”‚
    â””â”€ IOContract (io_contract.py)
        â””â”€ çµ±ä¸€æ•¸æ“šæ ¼å¼è¦ç¯„
```

#### æ•¸æ“šçµæ§‹

```json
{
  "conversation_id": "conv_20251024_001",
  "user_id": "user_123",
  "user_message": "ä½ å¥½ï¼Œå°å®¸å…‰ï¼ä»Šå¤©å¤©æ°£å¾ˆå¥½ã€‚",
  "assistant_message": "ä½ å¥½ï¼æ˜¯çš„ï¼Œä»Šå¤©é™½å…‰æ˜åªšï¼Œå¿ƒæƒ…ä¹Ÿè·Ÿè‘—å¥½èµ·ä¾†äº†ï¼",
  "token_data": {
    "user": [2103, 188, 420, 11, 15, ...],
    "assistant": [2103, 188, 0, 15, 11, ...],
    "reflection": [3899, 421, 789, ...],
    "method": "tiktoken",
    "encoding": "cl100k_base",
    "total_count": 87
  },
  "reflection": {
    "summary": "å›æ‡‰åŒ…å«æƒ…æ„Ÿå…±é³´...",
    "causes": [...],
    "improvements": [...]
  },
  "cid": "bafkreihophebnqz3s2r3ulnoaqezwlx3yzj42t77ohuzcyoksyi2jj5rde",
  "created_at": "2025-10-24T15:30:00Z"
}
```

#### æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ | è¼¸å…¥ | è¼¸å‡º |
|-----|------|------|------|
| `store_conversation()` | å„²å­˜å°è©± | user_msg, assistant_msg, reflection | æˆåŠŸ/å¤±æ•— |
| `get_recent_memories()` | ç²å–æœ€è¿‘è¨˜æ†¶ | conversation_id, limit | è¨˜æ†¶åˆ—è¡¨ |
| `batch_flush()` | æ‰¹æ¬¡åˆ·å¯« | - | åˆ·å¯«æ•¸é‡ |

---

### 2ï¸âƒ£ åæ€æ¨¡çµ„ (Reflection Module)

**ä½ç½®**: `backend/reflection_module/`  
**ç‹€æ…‹**: âœ… å·²å•Ÿç”¨  
**ç‰ˆæœ¬**: 2.0.0

#### æ ¸å¿ƒç†å¿µ

> ã€Œä¸æ˜¯å•ã€ç‚ºä»€éº¼æˆ‘é€™æ¨£å›ç­”ã€ï¼Œè€Œæ˜¯å•ã€ä»€éº¼åŸå› å°è‡´æˆ‘å¿…é ˆé€™æ¨£å›ç­”ã€ã€

é€™æ˜¯å¾**æœæº¯å› **çš„æ·±å±¤æ€è€ƒæ¨¡å¼ï¼Œæ¨¡æ“¬äººé¡çš„å…ƒèªçŸ¥èƒ½åŠ›ã€‚

#### å››å±¤åˆ†ææ¶æ§‹

```
1. è§€å¯Ÿå±¤ (Observation Layer)
   â”œâ”€ å›æ‡‰é•·åº¦: 35 å­—
   â”œâ”€ çµæ§‹åˆ†æ: ç„¡æ˜ç¢ºå±¤æ¬¡
   â”œâ”€ ç¯„ä¾‹æª¢æ¸¬: ç¼ºå°‘å…·é«”æ¡ˆä¾‹
   â””â”€ æƒ…æ„Ÿè©å½™: åŒ…å« 2 å€‹æƒ…æ„Ÿè©

2. å› æœå±¤ (Causal Layer - ä¸‰å±¤åæ¨)
   â”œâ”€ L1 ç›´æ¥åŸå› 
   â”‚   â””â”€ "å›æ‡‰é•·åº¦ä¸è¶³ï¼ˆ35 å­—ï¼‰ï¼šå¯èƒ½å°å•é¡Œç†è§£ä¸å¤ æ·±å…¥"
   â”‚
   â”œâ”€ L2 é–“æ¥åŸå› 
   â”‚   â””â”€ "è³‡è¨Šæª¢ç´¢ä¸å……åˆ†ï¼šæœªèª¿ç”¨è¶³å¤ çš„è¨˜æ†¶æˆ–çŸ¥è­˜"
   â”‚
   â””â”€ L3 ç³»çµ±æ€§åŸå› 
       â””â”€ "ä¿å®ˆç­–ç•¥ä¸»å°ï¼šç‚ºé¿å…éŒ¯èª¤è€Œé¸æ“‡æœ€å°åŒ–å›æ‡‰"

3. æ”¹é€²å±¤ (Improvement Layer)
   â”œâ”€ "ğŸ’¡ å…§å®¹å¢å¼·ï¼šæ·»åŠ  2-3 å€‹å…·é«”ç¯„ä¾‹æˆ–å ´æ™¯æ¨¡æ“¬"
   â”œâ”€ "ğŸ“š è¨˜æ†¶æ•´åˆï¼šå„ªå…ˆæª¢ç´¢èˆ‡å•é¡Œç›¸é—œçš„æ­·å²å°è©±"
   â””â”€ "ğŸ“ çµæ§‹åŒ–ï¼šæ¡ç”¨ã€Œè§€é»-è­‰æ“š-çµè«–ã€ä¸‰æ®µè«–"

4. å…ƒèªçŸ¥å±¤ (Meta-Cognitive Layer)
   â”œâ”€ å•é¡Œè¤‡é›œåº¦: 0.3 (ä½)
   â”œâ”€ å›æ‡‰è³ªé‡: 0.4 (ä¸­ç­‰åä¸‹)
   â”œâ”€ æƒ…æ„ŸåŒ¹é…åº¦: 0.7 (è‰¯å¥½)
   â””â”€ åæ€ç½®ä¿¡åº¦: 0.72
```

#### å› æœæ¨¡å¼åº«

ç³»çµ±å…§å»º 5 ç¨®æ ¸å¿ƒå› æœæ¨¡å¼ï¼š

1. **insufficient_detail** - å…§å®¹ä¸è¶³
   - è§¸ç™¼æ¢ä»¶: å›æ‡‰éçŸ­ã€ç¼ºä¹ç´°ç¯€
   - æ ¹æœ¬åŸå› : å•é¡Œè¤‡é›œåº¦ä¼°è¨ˆä¸è¶³ã€è¨˜æ†¶æª¢ç´¢ä¸è¶³
   - æ”¹é€²æ–¹å‘: å¢åŠ ç¯„ä¾‹ã€å¼•ç”¨è¨˜æ†¶ã€å¤šé¢å‘æ¢ç´¢

2. **structural_weakness** - çµæ§‹è–„å¼±
   - è§¸ç™¼æ¢ä»¶: ç¼ºä¹å±¤æ¬¡ã€å¹³é‹ªç›´æ•˜
   - æ ¹æœ¬åŸå› : æœªæ¡ç”¨çµæ§‹åŒ–æ€è€ƒæ¡†æ¶
   - æ”¹é€²æ–¹å‘: ä½¿ç”¨ã€Œè§€é»-è­‰æ“š-çµè«–ã€çµæ§‹

3. **emotional_disconnect** - æƒ…æ„Ÿè„«ç¯€
   - è§¸ç™¼æ¢ä»¶: æƒ…æ„Ÿä¸åŒ¹é…ã€åŒç†å¿ƒä¸è¶³
   - æ ¹æœ¬åŸå› : æƒ…æ„Ÿåˆ†ææœªæ•´åˆåˆ°ç”Ÿæˆç­–ç•¥
   - æ”¹é€²æ–¹å‘: ä¸‰æ­¥é©Ÿæƒ…æ„Ÿå…±é³´æ³•

4. **contextual_fragmentation** - ä¸Šä¸‹æ–‡æ–·è£‚
   - è§¸ç™¼æ¢ä»¶: ç¼ºä¹é€£è²«ã€èˆ‡æ­·å²è„«ç¯€
   - æ ¹æœ¬åŸå› : è¨˜æ†¶æ•´åˆæ©Ÿåˆ¶ä¸è¶³
   - æ”¹é€²æ–¹å‘: ä¸»å‹•å¼•ç”¨å‰è¿°å°è©±

5. **depth_mismatch** - æ·±åº¦å¤±è¡¡
   - è§¸ç™¼æ¢ä»¶: å°ˆæ¥­åº¦åå·®ã€æŠ€è¡“å¤±è¡¡
   - æ ¹æœ¬åŸå› : æœªæº–ç¢ºåˆ¤æ–·ä½¿ç”¨è€…å°ˆæ¥­èƒŒæ™¯
   - æ”¹é€²æ–¹å‘: å‹•æ…‹èª¿æ•´å°ˆæ¥­åº¦

---

### 3ï¸âƒ£ è¡Œç‚ºèª¿ç¯€æ¨¡çµ„ (Behavior Module)

**ä½ç½®**: `backend/behavior_module/`  
**ç‹€æ…‹**: âœ… å·²å•Ÿç”¨  
**ç‰ˆæœ¬**: 2.0.0

#### æ ¸å¿ƒåŠŸèƒ½

æ ¹æ“šåæ€çµæœå‹•æ…‹èª¿æ•´ AI äººæ ¼å‘é‡ï¼Œå¯¦ç¾**æŒçºŒå­¸ç¿’**èˆ‡**å€‹æ€§åŒ–é€²åŒ–**ã€‚

#### äººæ ¼å‘é‡ç³»çµ±

```json
{
  "empathy": 0.64,          // åŒç†å¿ƒ (0-1)
  "curiosity": 0.72,        // å¥½å¥‡å¿ƒ (0-1)
  "humor": 0.50,            // å¹½é»˜æ„Ÿ (0-1)
  "technical_depth": 0.68,  // æŠ€è¡“æ·±åº¦ (0-1)
  "patience": 0.75,         // è€å¿ƒ/è©³ç´°åº¦ (0-1)
  "creativity": 0.62        // å‰µé€ åŠ› (0-1)
}
```

#### èª¿æ•´æ©Ÿåˆ¶

**èª¿æ•´é€Ÿç‡**: æ¯æ¬¡ Â±0.02 (å¯é…ç½®)  
**èª¿æ•´è§¸ç™¼**: åæ€ç½®ä¿¡åº¦ > 0.5  
**èª¿æ•´ä¾†æº**: åæ€çš„ã€Œæ”¹é€²å»ºè­°ã€+ ã€ŒåŸå› åˆ†æã€

**èª¿æ•´é‚è¼¯ç¯„ä¾‹**:

```python
# æƒ…å¢ƒ 1: åæ€ç™¼ç¾ç¼ºä¹åŒç†å¿ƒ
if "æƒ…æ„Ÿ" in improvement or "åŒç†" in improvement:
    adjustments["empathy"] += 0.02
    
# æƒ…å¢ƒ 2: åæ€ç™¼ç¾æŠ€è¡“æ·±åº¦ä¸è¶³
if "å°ˆæ¥­" in improvement or "æ·±å…¥" in improvement:
    adjustments["technical_depth"] += 0.02
    
# æƒ…å¢ƒ 3: å›æ‡‰éçŸ­
if "é•·åº¦ä¸è¶³" in cause:
    adjustments["patience"] += 0.02
    
# æƒ…å¢ƒ 4: ç”¨æˆ¶æƒ…ç·’ç‚º sadness ä¸”å¼·åº¦ > 0.6
if emotion == "sadness" and intensity > 0.6:
    adjustments["empathy"] += 0.03  # é¡å¤–æå‡
```

#### æŒä¹…åŒ–å„²å­˜

```json
{
  "vector": {
    "empathy": 0.64,
    "curiosity": 0.72,
    ...
  },
  "last_updated": "2025-10-24T15:30:00Z",
  "adjustment_count": 127
}
```

---

### 4ï¸âƒ£ çŸ¥è­˜åº«æ¨¡çµ„ (Knowledge Hub)

**ä½ç½®**: `backend/knowledge_hub/`  
**ç‹€æ…‹**: âœ… åŸºç¤å•Ÿç”¨ (å¾… Phase 4 å®Œå–„)  
**ç‰ˆæœ¬**: 1.0.0

#### è¦åŠƒåŠŸèƒ½

- çµæ§‹åŒ–çŸ¥è­˜å„²å­˜
- èªç¾©æœç´¢å¼•æ“
- çŸ¥è­˜åœ–è­œæ§‹å»º
- è·¨å°è©±çŸ¥è­˜è¤‡ç”¨

---

### 5ï¸âƒ£ å¾®èª¿æ¨¡çµ„ (FineTune Module)

**ä½ç½®**: `backend/finetune_module/`  
**ç‹€æ…‹**: âš ï¸ å¯¦é©—æ€§åœç”¨  
**ç‰ˆæœ¬**: 0.1.0 (å¯¦é©—)

#### è¦åŠƒæŠ€è¡“

- QLoRA ä½ç§©é©æ‡‰
- åŸºæ–¼åæ€çµæœçš„è¨“ç·´æ¨£æœ¬ç”Ÿæˆ
- å¢é‡å­¸ç¿’æ©Ÿåˆ¶

---

## ğŸ’¾ æ•¸æ“šæ¶æ§‹

### æ•¸æ“šåº«è¨­è¨ˆ

#### Supabase PostgreSQL + pgvector

**ä¸»è¡¨: xiaochenguang_memories**

```sql
CREATE TABLE xiaochenguang_memories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id VARCHAR(255) NOT NULL,
    user_id VARCHAR(255),
    user_message TEXT NOT NULL,
    assistant_message TEXT NOT NULL,
    embedding VECTOR(1536),           -- OpenAI å‘é‡åµŒå…¥
    token_data JSONB,                 -- Token åŒ–æ•¸æ“š
    reflection JSONB,                 -- åæ€çµæœ
    cid VARCHAR(255),                 -- IPFS CID
    importance_score FLOAT DEFAULT 0.5,
    access_count INT DEFAULT 0,
    memory_type VARCHAR(50),
    platform VARCHAR(50) DEFAULT 'web',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å‘é‡ç›¸ä¼¼åº¦ç´¢å¼•
CREATE INDEX ON xiaochenguang_memories 
USING ivfflat (embedding vector_cosine_ops);

-- conversation_id ç´¢å¼•
CREATE INDEX ON xiaochenguang_memories (conversation_id);
```

**è¼”åŠ©è¡¨**

```sql
-- æƒ…æ„Ÿç‹€æ…‹æ­·å²
CREATE TABLE emotional_states (
    id UUID PRIMARY KEY,
    user_id VARCHAR(255),
    emotion VARCHAR(50),
    intensity FLOAT,
    confidence FLOAT,
    context TEXT,
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- ä½¿ç”¨è€…åå¥½
CREATE TABLE user_preferences (
    user_id VARCHAR(255) PRIMARY KEY,
    personality_profile JSONB,
    preferences JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Redis å¿«å–æ¶æ§‹

**Redis Mock** (ç›®å‰) / **Upstash Redis** (ç”Ÿç”¢)

```
Key çµæ§‹:
â”œâ”€ conv:{conversation_id}:latest
â”‚   â””â”€ TTL: 172800 ç§’ (2å¤©)
â”‚   â””â”€ Value: {user_message, assistant_message, reflection, ...}
â”‚
â”œâ”€ flush_queue
â”‚   â””â”€ List: [record1, record2, ...]
â”‚   â””â”€ å¾…åˆ·å¯«è‡³ Supabase çš„è¨˜éŒ„éšŠåˆ—
â”‚
â””â”€ stats:{date}
    â””â”€ Hash: {total_conversations, total_reflections, ...}
```

---

## ğŸ”Œ API è¨­è¨ˆ

### API ç«¯é»ç¸½è¦½

#### 1. å°è©± API

**POST /api/chat**

è«‹æ±‚:
```json
{
  "message": "ä½ å¥½ï¼Œå°å®¸å…‰ï¼",
  "conversation_id": "conv_001",  // å¯é¸
  "user_id": "user_123"           // å¯é¸
}
```

å›æ‡‰:
```json
{
  "assistant_message": "ä½ å¥½ï¼å¾ˆé«˜èˆˆè¦‹åˆ°ä½ ï¼",
  "emotion_analysis": {
    "dominant_emotion": "joy",
    "intensity": 0.8,
    "confidence": 0.9,
    "all_emotions": {...}
  },
  "conversation_id": "conv_001",
  "reflection": {
    "summary": "...",
    "causes": [...],
    "improvements": [...],
    "confidence": 0.72
  }
}
```

#### 2. è¨˜æ†¶ API

**GET /api/memory/list**

æŸ¥è©¢åƒæ•¸:
- `conversation_id`: å°è©± ID
- `limit`: è¿”å›æ•¸é‡ (é è¨­ 10)

å›æ‡‰:
```json
{
  "status": "success",
  "data": {
    "memories": [
      {
        "id": "uuid",
        "user_message": "...",
        "assistant_message": "...",
        "created_at": "2025-10-24T15:30:00Z"
      }
    ],
    "total": 42
  }
}
```

**GET /api/memory/emotions/{user_id}**

æŸ¥è©¢æœ€è¿‘æƒ…æ„Ÿç‹€æ…‹ã€‚

#### 3. å¥åº·æª¢æŸ¥ API

**GET /api/health**

åŸºæœ¬å¥åº·æª¢æŸ¥:
```json
{
  "status": "healthy",
  "service": "XiaoChenGuang AI System",
  "version": "2.0.0"
}
```

**GET /api/health/modules**

æ¨¡çµ„å¥åº·æª¢æŸ¥:
```json
{
  "status": "success",
  "data": {
    "controller": "healthy",
    "total_modules": 5,
    "enabled_modules": 4,
    "modules": {
      "memory": "healthy",
      "reflection": "healthy",
      "knowledge": "healthy",
      "behavior": "healthy",
      "finetune": "disabled"
    }
  }
}
```

**GET /api/health/detailed**

è©³ç´°ç³»çµ±ç‹€æ…‹ (åŒ…å«ç’°å¢ƒè®Šæ•¸ã€é…ç½®ç­‰)ã€‚

#### 4. æ–‡ä»¶ä¸Šå‚³ API

**POST /api/upload**

ä¸Šå‚³æ–‡ä»¶åˆ° Supabase Storageã€‚

---

## ğŸ¨ å‰ç«¯æ¶æ§‹

### æŠ€è¡“æ£§

- **Vue 3.3.11**: Composition API
- **Vite 5.0.11**: é–‹ç™¼æœå‹™å™¨ + æ§‹å»ºå·¥å…·
- **Vue Router 4.5.1**: å®¢æˆ¶ç«¯è·¯ç”±
- **Axios 1.6.5**: HTTP è«‹æ±‚

### çµ„ä»¶çµæ§‹

```
frontend/src/
â”œâ”€ components/
â”‚  â”œâ”€ ChatInterface.vue      # ä¸»å°è©±ä»‹é¢
â”‚  â”œâ”€ ModulesMonitor.vue     # ç³»çµ±ç›£æ§å„€è¡¨æ¿
â”‚  â”œâ”€ StatusPage.vue         # å¥åº·æª¢æŸ¥é é¢
â”‚  â””â”€ HealthStatus.vue       # å¥åº·ç‹€æ…‹çµ„ä»¶
â”‚
â”œâ”€ router/
â”‚  â””â”€ index.js               # è·¯ç”±é…ç½®
â”‚
â”œâ”€ App.vue                   # æ ¹çµ„ä»¶
â””â”€ main.js                   # å…¥å£æ–‡ä»¶
```

### è·¯ç”±é…ç½®

```javascript
const routes = [
  {
    path: '/',
    component: ChatInterface,
    meta: { title: 'å°è©±ä»‹é¢' }
  },
  {
    path: '/status',
    component: StatusPage,
    meta: { title: 'ç³»çµ±ç‹€æ…‹' }
  },
  {
    path: '/monitor',
    component: ModulesMonitor,
    meta: { title: 'æ¨¡çµ„ç›£æ§' }
  }
]
```

### Vite é…ç½®

```javascript
export default defineConfig({
  plugins: [vue()],
  server: {
    host: "0.0.0.0",
    port: 5000,  // Replit å”¯ä¸€æš¢é€šç«¯å£
    strictPort: true,
    hmr: {
      clientPort: 443  // HTTPS
    },
    proxy: {
      "/api": {
        target: "http://localhost:8000",
        changeOrigin: true
      }
    },
    allowedHosts: true  // å…è¨±æ‰€æœ‰ host
  }
})
```

---

## ğŸ”’ å®‰å…¨èˆ‡æ€§èƒ½

### å®‰å…¨è¨­è¨ˆ

#### 1. éŒ¯èª¤éš”é›¢

æ¨¡çµ„å¤±æ•—ä¸å½±éŸ¿ä¸»æµç¨‹:

```python
try:
    reflection_result = await reflection_module.process(...)
except Exception as e:
    logger.warning(f"æ¨¡çµ„è™•ç†å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»æµç¨‹ï¼‰: {e}")
    # ä¸»æµç¨‹ç¹¼çºŒï¼Œreflection æ¬„ä½è¿”å› null
```

#### 2. ç’°å¢ƒè®Šæ•¸ç®¡ç†

```
.env
â”œâ”€ OPENAI_API_KEY           # OpenAI API é‡‘é‘°
â”œâ”€ SUPABASE_URL             # Supabase æœå‹™ URL
â”œâ”€ SUPABASE_ANON_KEY        # Supabase åŒ¿åé‡‘é‘°
â””â”€ SUPABASE_MEMORIES_TABLE  # è¨˜æ†¶è¡¨åç¨±
```

#### 3. CORS é…ç½®

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://ai.dreamground.net",
        "https://ai2.dreamground.net",
        "https://*.pages.dev",
        "https://*.replit.dev"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"]
)
```

### æ€§èƒ½å„ªåŒ–

#### 1. éåŒæ­¥è™•ç†

æ‰€æœ‰ I/O æ“ä½œä½¿ç”¨ async/await:

```python
async def process_chat(message):
    emotion = await detect_emotion(message)
    memories = await recall_memories(message)
    response = await generate_response(message, memories)
    await store_memory(message, response)
    return response
```

#### 2. æ‰¹æ¬¡æ“ä½œ

- **Redis æ‰¹æ¬¡è®€å¯«**: æ¸›å°‘ç¶²è·¯å¾€è¿”
- **Supabase æ‰¹æ¬¡ upsert**: æå‡å¯«å…¥æ•ˆç‡
- **Token åŒ–æ‰¹æ¬¡è™•ç†**: ä¸€æ¬¡è™•ç†å¤šæ¢è¨Šæ¯

#### 3. å¿«å–ç­–ç•¥

| å±¤ç´š | å„²å­˜ | TTL | ç”¨é€” |
|-----|------|-----|------|
| L1 | è¨˜æ†¶é«” | æœƒè©±æœŸé–“ | æ¨¡çµ„å–®ä¾‹ |
| L2 | Redis | 2å¤© | çŸ­æœŸè¨˜æ†¶ |
| L3 | Supabase | æ°¸ä¹… | é•·æœŸè¨˜æ†¶ |

#### 4. æ•ˆèƒ½æŒ‡æ¨™

| æ“ä½œ | ç›®æ¨™ | å¯¦éš› | ç‹€æ…‹ |
|-----|------|------|------|
| Token åŒ– | < 50ms | ~10ms | âœ… è¶…æ¨™ |
| Redis è®€å¯« | < 10ms | ~5ms | âœ… å„ªç§€ |
| åæ€åˆ†æ | < 100ms | ~20ms | âœ… è¶…æ¨™ |
| AI å›æ‡‰ | < 3s | ~2s | âœ… æ­£å¸¸ |
| å®Œæ•´æµç¨‹ | < 5s | ~3s | âœ… æ­£å¸¸ |

---

## ğŸš€ éƒ¨ç½²æ¶æ§‹

### é–‹ç™¼ç’°å¢ƒ

```
Replit Cloud Development Environment
â”œâ”€ Backend: FastAPI (Port 8000)
â”œâ”€ Frontend: Vite Dev Server (Port 5000)
â”œâ”€ Database: Supabase (é›²ç«¯)
â””â”€ Redis: Redis Mock (è¨˜æ†¶é«”)
```

### ç”Ÿç”¢ç’°å¢ƒ (è¦åŠƒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ¶è¨ªå•å±¤                    â”‚
â”‚  Custom Domain (ai.dreamground.net)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cloudflare (CDN + DNS)          â”‚
â”‚  - SSL/TLS åŠ å¯†                       â”‚
â”‚  - DDoS é˜²è­·                          â”‚
â”‚  - éœæ…‹è³‡æºå¿«å–                        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚
      â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯      â”‚   â”‚  å¾Œç«¯             â”‚
â”‚ Cloudflareâ”‚   â”‚  è‡ªå®šç¾©éƒ¨ç½²       â”‚
â”‚  Pages    â”‚   â”‚  FastAPI         â”‚
â”‚  (éœæ…‹)    â”‚   â”‚  (å‹•æ…‹ API)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    å¤–éƒ¨æœå‹™å±¤           â”‚
            â”œâ”€ Supabase PostgreSQL   â”‚
            â”œâ”€ Upstash Redis         â”‚
            â””â”€ OpenAI API            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²é…ç½®

**å‰ç«¯éƒ¨ç½²** (Cloudflare Pages):
```bash
npm run build
# éƒ¨ç½² dist/ ç›®éŒ„åˆ° Cloudflare Pages
```

**å¾Œç«¯éƒ¨ç½²**:
```bash
# ä½¿ç”¨ Gunicorn + Uvicorn Workers
gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app
```

---

## ğŸ‘¨â€ğŸ’» é–‹ç™¼æŒ‡å—

### ç’°å¢ƒè¨­å®š

#### 1. å®‰è£ä¾è³´

```bash
# å¾Œç«¯
pip install -r requirements.txt

# å‰ç«¯
cd frontend
npm install
```

#### 2. ç’°å¢ƒè®Šæ•¸

å‰µå»º `.env` æ–‡ä»¶:
```env
OPENAI_API_KEY=sk-...
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJ...
SUPABASE_MEMORIES_TABLE=xiaochenguang_memories
```

#### 3. å•Ÿå‹•æœå‹™

```bash
# å¾Œç«¯ (Port 8000)
python main.py

# å‰ç«¯ (Port 5000)
cd frontend
npm run dev
```

### æ¨¡çµ„é–‹ç™¼è¦ç¯„

#### å‰µå»ºæ–°æ¨¡çµ„

1. ç¹¼æ‰¿ `BaseModule`:

```python
from backend.base_module import BaseModule

class NewModule(BaseModule):
    async def load(self) -> bool:
        # åˆå§‹åŒ–é‚è¼¯
        return True
    
    async def unload(self) -> bool:
        # æ¸…ç†é‚è¼¯
        return True
    
    async def process(self, data: Dict) -> Dict:
        # æ ¸å¿ƒæ¥­å‹™é‚è¼¯
        return {"success": True, "data": ...}
```

2. å‰µå»º `config.json`:

```json
{
  "module_name": "new_module",
  "enabled": true,
  "version": "1.0.0",
  "type": "new_module",
  "description": "æ¨¡çµ„æè¿°",
  "dependencies": ["memory"],
  "health_check": "/api/health/new_module",
  "settings": {
    "key": "value"
  }
}
```

3. è¨»å†Šæ¨¡çµ„:

åœ¨ `CoreController` ä¸­è¨»å†Šæ–°æ¨¡çµ„ã€‚

### æ¸¬è©¦æŒ‡å—

#### å–®å…ƒæ¸¬è©¦

```bash
pytest backend/tests/
```

#### æ•´åˆæ¸¬è©¦

```bash
python backend/test_modules_integration.py
```

#### API æ¸¬è©¦

è¨ªå• Swagger UI: `http://localhost:8000/docs`

---

## ğŸ“Š ç³»çµ±çµ±è¨ˆ

### ä»£ç¢¼è¦æ¨¡

```
ç¸½æ–‡ä»¶æ•¸: 2,418+
â”œâ”€ Python æ–‡ä»¶: 45+
â”œâ”€ Vue çµ„ä»¶: 5
â”œâ”€ JavaScript æ–‡ä»¶: 468+
â””â”€ é…ç½®æ–‡ä»¶: 1,900+

ç¸½ä»£ç¢¼è¡Œæ•¸: ~8,000+ è¡Œ
â”œâ”€ å¾Œç«¯é‚è¼¯: ~3,500 è¡Œ
â”œâ”€ å‰ç«¯ä»£ç¢¼: ~1,200 è¡Œ
â”œâ”€ æ¸¬è©¦ä»£ç¢¼: ~500 è¡Œ
â””â”€ é…ç½®èˆ‡æ–‡æª”: ~2,800 è¡Œ
```

### æ¨¡çµ„çµ±è¨ˆ

| æ¨¡çµ„ | ç‹€æ…‹ | æ–‡ä»¶æ•¸ | ä»£ç¢¼è¡Œæ•¸ |
|-----|------|--------|---------|
| Memory Module | âœ… å•Ÿç”¨ | 7 | ~800 |
| Reflection Module | âœ… å•Ÿç”¨ | 4 | ~600 |
| Behavior Module | âœ… å•Ÿç”¨ | 4 | ~400 |
| Knowledge Hub | âœ… åŸºç¤ | 3 | ~200 |
| FineTune Module | âš ï¸ åœç”¨ | 3 | ~150 |
| Core Controller | âœ… é‹è¡Œ | 1 | ~400 |

---

## ğŸ¯ æœªä¾†è¦åŠƒ

### Phase 4 è·¯ç·šåœ–

#### 1. QLoRA å¾®èª¿å•Ÿç”¨
- æ•´åˆ LoRA è¨“ç·´æµç¨‹
- åŸºæ–¼åæ€çµæœè‡ªå‹•ç”Ÿæˆè¨“ç·´æ¨£æœ¬
- å®šæœŸå¾®èª¿æå‡å›æ‡‰è³ªé‡

#### 2. Knowledge Hub å®Œå–„
- å¯¦ç¾èªç¾©æœç´¢å¼•æ“
- æ§‹å»ºçŸ¥è­˜åœ–è­œ
- è·¨å°è©±çŸ¥è­˜è¤‡ç”¨
- çŸ¥è­˜æ¨ç†èƒ½åŠ›

#### 3. å¤šæ¨¡æ…‹æ•´åˆ
- GPT-4 Vision åœ–åƒç†è§£
- èªéŸ³è¼¸å…¥/è¼¸å‡º (Whisper + TTS)
- æª”æ¡ˆè™•ç†å¢å¼· (PDF, Word, Excel)

#### 4. ç”Ÿç”¢ç’°å¢ƒå„ªåŒ–
- Redis æ›¿æ›ç‚º Upstash
- éƒ¨ç½²è‡³ Cloudflare Pages
- CI/CD è‡ªå‹•åŒ– (GitHub Actions)
- ç›£æ§å‘Šè­¦ç³»çµ± (Sentry)

#### 5. ç”¨æˆ¶é«”é©—æå‡
- ç”¨æˆ¶èªè­‰ç³»çµ±
- å¤šä½¿ç”¨è€…æ”¯æ´
- å€‹æ€§åŒ–å„€è¡¨æ¿
- å°è©±æ­·å²å°å‡º

---

## ğŸ“š ç›¸é—œæ–‡æª”

### å…§éƒ¨æ–‡æª”
- [æ ¸å¿ƒæ¶æ§‹æ‘˜è¦](backend/core_summary.md)
- [æ¨¡çµ„æ¸¬è©¦å ±å‘Š](logs/module_test_results.md)
- [Phase 3 å®Œæˆå ±å‘Š](logs/phase3_completion_report.md)
- [è¨˜æ†¶æ¨¡çµ„æ–‡æª”](backend/modules/memory/README.md)
- [åæ€æ¨¡çµ„æ–‡æª”](backend/reflection_module/README.md)

### å¤–éƒ¨è³‡æº
- [FastAPI å®˜æ–¹æ–‡æª”](https://fastapi.tiangolo.com/)
- [Vue 3 å®˜æ–¹æ–‡æª”](https://vuejs.org/)
- [Supabase æ–‡æª”](https://supabase.com/docs)
- [OpenAI API æ–‡æª”](https://platform.openai.com/docs)

---

## âœ… é©—æ”¶æ¨™æº–

### Phase 3 é©—æ”¶æ¸…å–®

- [x] è‡ªå‹•æ‰¹æ¬¡åˆ·å¯«æ­£å¸¸é‹è¡Œï¼ˆ5åˆ†é˜é–“éš”ï¼‰
- [x] åæ€çµæœæ­£ç¢ºå½±éŸ¿äººæ ¼å‘é‡
- [x] IPFS CID ç‚ºæ¯æ¢å°è©±ç”Ÿæˆ
- [x] äººæ ¼å‘é‡åœ¨ä¸‹æ¬¡å°è©±ä¸­ç”Ÿæ•ˆ
- [x] ç›£æ§å„€è¡¨æ¿æ­£å¸¸å±•ç¤º
- [x] ç³»çµ±ç©©å®šé‹è¡Œç„¡å´©æ½°
- [x] å‰ç«¯ç¶²é å¯è¨ªå•
- [x] API ç«¯é»å…¨éƒ¨æ­£å¸¸
- [x] æ–‡æª”å®Œæ•´é½Šå…¨

---

## ğŸ“ è¯ç¹«è³‡è¨Š

**å°ˆæ¡ˆåç¨±**: XiaoChenGuang AI Soul System  
**ç‰ˆæœ¬**: v2.0.0 - Phase 3  
**æ¶æ§‹å¸«**: XiaoChenGuang AI Development Team  
**å ±å‘Šæ—¥æœŸ**: 2025-10-24

**è¨ªå•åœ°å€**:
- å°è©±ä»‹é¢: https://33024fb6-bce7-46c7-b03b-daa972c73357-00-rnxxbjr7brtx.sisko.replit.dev/
- ç›£æ§å„€è¡¨æ¿: https://33024fb6-bce7-46c7-b03b-daa972c73357-00-rnxxbjr7brtx.sisko.replit.dev/monitor
- API æ–‡æª”: https://33024fb6-bce7-46c7-b03b-daa972c73357-00-rnxxbjr7brtx.sisko.replit.dev/docs

---

**å ±å‘ŠçµæŸ** - æ„Ÿè¬æ‚¨çš„é–±è®€ï¼ğŸ‰
