<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>語義記憶管理系統</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>🧠 語義記憶管理系統</h1>
            <p class="subtitle">AI 對話延續與記憶應用</p>
        </header>

        <div class="status-box">
            {% if current_sheet %}
                <div class="status-active">
                    <strong>目前使用的記錄本：</strong>
                    <span class="sheet-name">{{ current_sheet }}</span>
                </div>
            {% else %}
                <div class="status-inactive">
                    <strong>狀態：</strong>尚未啟動任何對話
                </div>
            {% endif %}
        </div>

        <div class="actions">
            <div class="action-card">
                <h2>🆕 建立新對話</h2>
                <p>建立一個全新的對話記錄本</p>
                <form id="newConversationForm">
                    <input type="text" id="newSheetName" name="sheet_name" 
                           placeholder="輸入對話名稱（例如：專案討論_2024）" required>
                    <button type="submit" class="btn btn-primary">建立新對話</button>
                </form>
                <div id="newConversationUrl" class="url-display"></div>
            </div>

            <div class="action-card">
                <h2>📖 延續已有對話</h2>
                <p>載入並繼續之前的對話記錄</p>
                <form id="resumeConversationForm">
                    <input type="text" id="resumeSheetName" name="sheet_name" 
                           placeholder="輸入現有對話名稱" required>
                    <button type="submit" class="btn btn-success">延續對話</button>
                </form>
                <div id="resumeConversationUrl" class="url-display"></div>
            </div>
        </div>

        <div class="api-endpoints-section">
            <h3>🔌 API 端點（提供給 AI 語言模型使用）</h3>
            <p class="api-description">將以下網址複製給您的 AI 助手，讓它能夠記錄和查詢對話：</p>
            
            <div class="endpoint-card">
                <h4>📝 記錄對話</h4>
                <div class="url-copy-box">
                    <code id="logEndpoint">{{ request.url_root }}log</code>
                    <button onclick="copyToClipboard('logEndpoint')" class="btn btn-small">複製</button>
                </div>
                <p class="endpoint-hint">POST 請求，JSON 格式：<code>{"user_message": "...", "ai_response": "..."}</code></p>
            </div>

            <div class="endpoint-card">
                <h4>📖 查詢歷史</h4>
                <div class="url-copy-box">
                    <code id="historyEndpoint">{{ request.url_root }}get_history?sheet_name=對話名稱&limit=5</code>
                    <button onclick="copyToClipboard('historyEndpoint')" class="btn btn-small">複製</button>
                </div>
                <p class="endpoint-hint">GET 請求，參數：sheet_name（必填）、limit（可選，預設5）</p>
            </div>

            <div class="endpoint-card">
                <h4>🚀 啟動對話</h4>
                <div class="url-copy-box">
                    <code id="startEndpoint">{{ request.url_root }}start?mode=resume&sheet_name=對話名稱</code>
                    <button onclick="copyToClipboard('startEndpoint')" class="btn btn-small">複製</button>
                </div>
                <p class="endpoint-hint">GET 請求，參數：mode（new/resume）、sheet_name</p>
            </div>
        </div>

        <div class="info-section">
            <h3>📚 使用說明</h3>
            <ul>
                <li><strong>建立新對話：</strong>輸入一個新的對話名稱，系統會在 Google Sheets 中建立新的工作表</li>
                <li><strong>延續已有對話：</strong>輸入已存在的對話名稱，系統會載入該工作表的歷史記錄</li>
                <li><strong>整合到 AI：</strong>複製上方 API 端點網址，告訴您的 AI 助手使用這些網址來記錄和查詢對話</li>
            </ul>
        </div>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('✅ 已複製到剪貼簿！\n\n' + text);
            }).catch(err => {
                console.error('複製失敗：', err);
                alert('❌ 複製失敗，請手動複製');
            });
        }

        document.getElementById('newConversationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sheetName = document.getElementById('newSheetName').value.trim();
            if (sheetName) {
                const url = `${window.location.origin}/start?mode=new&sheet_name=${encodeURIComponent(sheetName)}`;
                window.location.href = url;
            }
        });

        document.getElementById('resumeConversationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sheetName = document.getElementById('resumeSheetName').value.trim();
            if (sheetName) {
                const url = `${window.location.origin}/start?mode=resume&sheet_name=${encodeURIComponent(sheetName)}`;
                window.location.href = url;
            }
        });
    </script>
</body>
</html>
