<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªç¾©è¨˜æ†¶ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  èªç¾©è¨˜æ†¶ç®¡ç†ç³»çµ±</h1>
            <p class="subtitle">AI å°è©±å»¶çºŒèˆ‡è¨˜æ†¶æ‡‰ç”¨</p>
        </header>

        <div class="status-box">
            {% if current_sheet %}
                <div class="status-active">
                    <strong>ç›®å‰ä½¿ç”¨çš„è¨˜éŒ„æœ¬ï¼š</strong>
                    <span class="sheet-name">{{ current_sheet }}</span>
                </div>
            {% else %}
                <div class="status-inactive">
                    <strong>ç‹€æ…‹ï¼š</strong>å°šæœªå•Ÿå‹•ä»»ä½•å°è©±
                </div>
            {% endif %}
        </div>

        <div class="actions">
            <div class="action-card">
                <h2>ğŸ†• å»ºç«‹æ–°å°è©±</h2>
                <p>å»ºç«‹ä¸€å€‹å…¨æ–°çš„å°è©±è¨˜éŒ„æœ¬</p>
                <form id="newConversationForm">
                    <input type="text" id="newSheetName" name="sheet_name" 
                           placeholder="è¼¸å…¥å°è©±åç¨±ï¼ˆä¾‹å¦‚ï¼šå°ˆæ¡ˆè¨è«–_2024ï¼‰" required>
                    <button type="submit" class="btn btn-primary">å»ºç«‹æ–°å°è©±</button>
                </form>
                <div id="newConversationUrl" class="url-display"></div>
            </div>

            <div class="action-card">
                <h2>ğŸ“– å»¶çºŒå·²æœ‰å°è©±</h2>
                <p>è¼‰å…¥ä¸¦ç¹¼çºŒä¹‹å‰çš„å°è©±è¨˜éŒ„</p>
                <form id="resumeConversationForm">
                    <input type="text" id="resumeSheetName" name="sheet_name" 
                           placeholder="è¼¸å…¥ç¾æœ‰å°è©±åç¨±" required>
                    <button type="submit" class="btn btn-success">å»¶çºŒå°è©±</button>
                </form>
                <div id="resumeConversationUrl" class="url-display"></div>
            </div>
        </div>

        <div class="api-endpoints-section">
            <h3>ğŸ”Œ API ç«¯é»ï¼ˆæä¾›çµ¦ AI èªè¨€æ¨¡å‹ä½¿ç”¨ï¼‰</h3>
            <p class="api-description">å°‡ä»¥ä¸‹ç¶²å€è¤‡è£½çµ¦æ‚¨çš„ AI åŠ©æ‰‹ï¼Œè®“å®ƒèƒ½å¤ è¨˜éŒ„å’ŒæŸ¥è©¢å°è©±ï¼š</p>
            
            <div class="endpoint-card">
                <h4>ğŸ“ è¨˜éŒ„å°è©±</h4>
                <div class="url-copy-box">
                    <code id="logEndpoint">{{ request.url_root }}log</code>
                    <button onclick="copyToClipboard('logEndpoint')" class="btn btn-small">è¤‡è£½</button>
                </div>
                <p class="endpoint-hint">POST è«‹æ±‚ï¼ŒJSON æ ¼å¼ï¼š<code>{"user_message": "...", "ai_response": "..."}</code></p>
            </div>

            <div class="endpoint-card">
                <h4>ğŸ“– æŸ¥è©¢æ­·å²</h4>
                <div class="url-copy-box">
                    <code id="historyEndpoint">{{ request.url_root }}get_history?sheet_name=å°è©±åç¨±&limit=5</code>
                    <button onclick="copyToClipboard('historyEndpoint')" class="btn btn-small">è¤‡è£½</button>
                </div>
                <p class="endpoint-hint">GET è«‹æ±‚ï¼Œåƒæ•¸ï¼šsheet_nameï¼ˆå¿…å¡«ï¼‰ã€limitï¼ˆå¯é¸ï¼Œé è¨­5ï¼‰</p>
            </div>

            <div class="endpoint-card">
                <h4>ğŸš€ å•Ÿå‹•å°è©±</h4>
                <div class="url-copy-box">
                    <code id="startEndpoint">{{ request.url_root }}start?mode=resume&sheet_name=å°è©±åç¨±</code>
                    <button onclick="copyToClipboard('startEndpoint')" class="btn btn-small">è¤‡è£½</button>
                </div>
                <p class="endpoint-hint">GET è«‹æ±‚ï¼Œåƒæ•¸ï¼šmodeï¼ˆnew/resumeï¼‰ã€sheet_name</p>
            </div>
        </div>

        <div class="info-section">
            <h3>ğŸ“š ä½¿ç”¨èªªæ˜</h3>
            <ul>
                <li><strong>å»ºç«‹æ–°å°è©±ï¼š</strong>è¼¸å…¥ä¸€å€‹æ–°çš„å°è©±åç¨±ï¼Œç³»çµ±æœƒåœ¨ Google Sheets ä¸­å»ºç«‹æ–°çš„å·¥ä½œè¡¨</li>
                <li><strong>å»¶çºŒå·²æœ‰å°è©±ï¼š</strong>è¼¸å…¥å·²å­˜åœ¨çš„å°è©±åç¨±ï¼Œç³»çµ±æœƒè¼‰å…¥è©²å·¥ä½œè¡¨çš„æ­·å²è¨˜éŒ„</li>
                <li><strong>æ•´åˆåˆ° AIï¼š</strong>è¤‡è£½ä¸Šæ–¹ API ç«¯é»ç¶²å€ï¼Œå‘Šè¨´æ‚¨çš„ AI åŠ©æ‰‹ä½¿ç”¨é€™äº›ç¶²å€ä¾†è¨˜éŒ„å’ŒæŸ¥è©¢å°è©±</li>
            </ul>
        </div>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\n\n' + text);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—ï¼š', err);
                alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        document.getElementById('newConversationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sheetName = document.getElementById('newSheetName').value.trim();
            if (sheetName) {
                const url = `${window.location.origin}/start?mode=new&sheet_name=${encodeURIComponent(sheetName)}`;
                window.location.href = url;
            }
        });

        document.getElementById('resumeConversationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sheetName = document.getElementById('resumeSheetName').value.trim();
            if (sheetName) {
                const url = `${window.location.origin}/start?mode=resume&sheet_name=${encodeURIComponent(sheetName)}`;
                window.location.href = url;
            }
        });
    </script>
</body>
</html>
