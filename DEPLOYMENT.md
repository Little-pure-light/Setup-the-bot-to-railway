# ğŸš€ å°å®¸å…‰ AI éˆé­‚ç³»çµ± - éƒ¨ç½²æŒ‡å—

## âœ… éƒ¨ç½²é…ç½®å·²å®Œæˆ

ä½ çš„ç³»çµ±æ¡ç”¨**å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹**ï¼š
- **å‰ç«¯**ï¼šVue 3 éƒ¨ç½²åœ¨ Cloudflare Pages â˜ï¸
- **å¾Œç«¯**ï¼šFastAPI éƒ¨ç½²åœ¨ Replitï¼ˆç´” API æœå‹™ï¼‰ğŸš€

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare Pages (å‰ç«¯)            â”‚
â”‚   https://ai.dreamground.net        â”‚
â”‚   - Vue 3 + Vite                    â”‚
â”‚   - éœæ…‹è³‡æº CDN åŠ é€Ÿ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ API è«‹æ±‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Replit (å¾Œç«¯ API)                  â”‚
â”‚   https://your-app.replit.app       â”‚
â”‚   - FastAPI + Uvicorn               â”‚
â”‚   - æ‰€æœ‰æ¥­å‹™é‚è¼¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â†“                 â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Supabaseâ”‚    â”‚  Redis   â”‚  â”‚Pineconeâ”‚  â”‚Pinataâ”‚
â”‚PostgreSQLâ”‚   â”‚ (Upstash)â”‚  â”‚ Vector â”‚  â”‚ IPFS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

### å¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼ˆReplit Secretsï¼‰

ç¢ºä¿ä»¥ä¸‹ API é‡‘é‘°å·²è¨­ç½®ï¼š

- âœ… `OPENAI_API_KEY` - OpenAI APIï¼ˆGPT-4o-mini + Vision APIï¼‰
- âœ… `SUPABASE_URL` - Supabase è³‡æ–™åº«é€£æ¥
- âœ… `SUPABASE_KEY` - Supabase API é‡‘é‘°
- âœ… `REDIS_URL` - Redis å¿«å–æœå‹™ï¼ˆUpstashï¼Œè‡ªå‹•è½‰æ› SSLï¼‰
- âœ… `PINATA_JWT` - Pinata IPFS æœå‹™ï¼ˆå°è©±å°å­˜ï¼‰
- âœ… `PINECONE_API_KEY` - Pinecone å‘é‡è³‡æ–™åº«
- âœ… `PINECONE_ENVIRONMENT` - Pinecone ç’°å¢ƒ
- âœ… `PINECONE_INDEX_NAME` - Pinecone ç´¢å¼•åç¨±

### è³‡æ–™åº«è¡¨æ ¼ï¼ˆSupabaseï¼‰

ç¢ºä¿å·²å»ºç«‹ä»¥ä¸‹è¡¨æ ¼ï¼š

1. `xiaochenguang_memories` - å°è©±è¨˜æ†¶
2. `xiaochenguang_emotional_states` - æƒ…ç·’ç‹€æ…‹
3. `xiaochenguang_user_preferences` - ç”¨æˆ¶åå¥½
4. `xiaochenguang_reflections` - AI åæ€è¨˜éŒ„
5. `conversation_archive` - IPFS å°å­˜è¨˜éŒ„

**å¿«é€Ÿå»ºç«‹**ï¼šåŸ·è¡Œ `supabase_conversation_archive_schema.sql`

## ğŸ¯ å¾Œç«¯éƒ¨ç½²æ­¥é©Ÿï¼ˆReplitï¼‰

### ä¸€éµéƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

1. **é»æ“Šå³ä¸Šè§’çš„ "Deploy" æŒ‰éˆ•** ğŸš€
2. **é¸æ“‡éƒ¨ç½²é¡å‹**ï¼šAutoscaleï¼ˆç„¡ç‹€æ…‹ï¼Œè‡ªå‹•æ“´å±•ï¼‰
3. **ç¢ºèªè¨­å®š**ï¼š
   - Build å‘½ä»¤ï¼šç„¡ï¼ˆç´” APIï¼Œä¸éœ€è¦æ§‹å»ºï¼‰
   - Run å‘½ä»¤ï¼š`uvicorn main:app --host 0.0.0.0 --port 5000`
4. **é»æ“Š "Deploy"**
5. **ç­‰å¾… 30-60 ç§’**ï¼Œå®Œæˆï¼âœ¨
6. **ç²å¾—å¾Œç«¯ API ç¶²å€**ï¼š`https://your-app.replit.app`

### æ‰‹å‹•æ¸¬è©¦ï¼ˆå¯é¸ï¼‰

```bash
# æ¸¬è©¦æœ¬åœ° API æœå‹™å™¨
uvicorn main:app --host 0.0.0.0 --port 5000

# æ¸¬è©¦å¥åº·ç«¯é»
curl http://localhost:5000/health
```

## ğŸŒ å‰ç«¯é…ç½®ï¼ˆCloudflare Pagesï¼‰

### ç’°å¢ƒè®Šæ•¸è¨­å®š

åœ¨ Cloudflare Pages è¨­å®šä¸­æ·»åŠ ï¼š

```bash
VITE_API_URL=https://your-app.replit.app
```

**é‡è¦**ï¼šæ›¿æ›ç‚ºä½ çš„å¯¦éš› Replit éƒ¨ç½²ç¶²å€ï¼

### æ§‹å»ºè¨­å®š

- **æ§‹å»ºå‘½ä»¤**ï¼š`npm run build`
- **æ§‹å»ºè¼¸å‡ºç›®éŒ„**ï¼š`dist`
- **æ ¹ç›®éŒ„**ï¼š`frontend`

## ğŸ”’ CORS å®‰å…¨é…ç½®

å¾Œç«¯å·²é è¨­å…è¨±ä»¥ä¸‹ä¾†æºï¼š

```python
allow_origins=[
    "https://ai.dreamground.net",      # ä½ çš„ä¸»åŸŸå
    "https://ai2.dreamground.net",     # å‚™ç”¨åŸŸå
    "https://*.pages.dev",             # Cloudflare Pages é è¦½
    "https://*.replit.dev",            # Replit é–‹ç™¼ç’°å¢ƒ
    "http://localhost:3000",           # æœ¬åœ°é–‹ç™¼
    "http://localhost:5000"
]
```

å¦‚éœ€æ·»åŠ æ–°åŸŸåï¼Œç·¨è¼¯ `main.py` ä¸­çš„ CORS è¨­å®šã€‚

## ğŸ“Š API ç«¯é»åˆ—è¡¨

éƒ¨ç½²å¾Œå¯ç”¨çš„ç«¯é»ï¼š

### å¥åº·æª¢æŸ¥
- `GET  /` - åŸºæœ¬ä¿¡æ¯
- `GET  /health` - ç³»çµ±å¥åº·ç‹€æ…‹
- `GET  /api/health` - API å¥åº·æª¢æŸ¥

### AI å°è©±
- `POST /api/chat` - ç™¼é€è¨Šæ¯çµ¦ AI

### è¨˜æ†¶ç³»çµ±
- `GET  /api/memories/{conversation_id}` - ç²å–å°è©±è¨˜æ†¶
- `GET  /api/emotional-states/{user_id}` - ç²å–æƒ…ç·’ç‹€æ…‹

### æª”æ¡ˆä¸Šå‚³ï¼ˆ7 ç¨®æ ¼å¼ï¼‰
- `POST /api/upload_file` - ä¸Šå‚³æª”æ¡ˆ
  - æ”¯æ´ï¼š`.txt`, `.md`, `.json`, `.pdf`, `.docx`, `.png`, `.jpg`, `.jpeg`
  - Vision API è‡ªå‹•åˆ†æåœ–ç‰‡å…§å®¹

### å°è©±å°å­˜
- `POST /api/archive_conversation` - å°å­˜å°è©±åˆ° IPFS
  - è‡ªå‹•æ‰“åŒ…è¨Šæ¯ + é™„ä»¶
  - ä¸Šå‚³åˆ° Pinata IPFS
  - è¿”å›å…¬é–‹ç¶²å€

## ğŸ§ª éƒ¨ç½²å¾Œæ¸¬è©¦

### 1. å¥åº·æª¢æŸ¥

```bash
curl https://your-app.replit.app/health
```

é æœŸå›æ‡‰ï¼š
```json
{
  "status": "healthy",
  "service": "å°æ™¨å…‰ AI",
  "version": "1.0.1"
}
```

### 2. API æ¸¬è©¦

```bash
curl -X POST https://your-app.replit.app/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_message": "ä½ å¥½",
    "user_id": "test_user",
    "conversation_id": "test_conv"
  }'
```

### 3. æª”æ¡ˆä¸Šå‚³æ¸¬è©¦

```bash
curl -X POST https://your-app.replit.app/api/upload_file \
  -F "file=@test.txt" \
  -F "conversation_id=test_conv" \
  -F "user_id=test_user"
```

## ğŸ”§ å¸¸è¦‹å•é¡Œ

### å•é¡Œ 1ï¼šå‰ç«¯ç„¡æ³•é€£æ¥å¾Œç«¯

**ç—‡ç‹€**ï¼šCloudflare Pages å‰ç«¯é¡¯ç¤ºç¶²è·¯éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ Cloudflare Pages ç’°å¢ƒè®Šæ•¸ `VITE_API_URL` æ˜¯å¦æ­£ç¢º
2. ç¢ºèªå¾Œç«¯ CORS è¨­å®šåŒ…å«ä½ çš„å‰ç«¯åŸŸå
3. é‡æ–°æ§‹å»ºå‰ç«¯ï¼ˆCloudflare Pages æœƒè‡ªå‹•è§¸ç™¼ï¼‰

### å•é¡Œ 2ï¼šRedis é€£æ¥å¤±æ•—

**ç—‡ç‹€**ï¼šæ—¥èªŒé¡¯ç¤º "Connection closed by server"

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç³»çµ±æœƒè‡ªå‹•è½‰æ› `redis://` ç‚º `rediss://`ï¼ˆSSLï¼‰
- ç¢ºèª `REDIS_URL` æ ¼å¼æ­£ç¢º
- æª¢æŸ¥ Upstash Redis æ˜¯å¦æ­£å¸¸é‹è¡Œ

### å•é¡Œ 3ï¼šIPFS ä¸Šå‚³å¤±æ•—

**ç—‡ç‹€**ï¼šå°å­˜å°è©±æ™‚è¿”å›æœ¬åœ° CID

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ `PINATA_JWT` æ˜¯å¦æ­£ç¢º
- ç³»çµ±æœƒè‡ªå‹•é™ç´šåˆ°æœ¬åœ° CIDï¼ˆä¸å½±éŸ¿åŠŸèƒ½ï¼‰
- æŸ¥çœ‹æ—¥èªŒç¢ºèª Pinata API éŒ¯èª¤è¨Šæ¯

### å•é¡Œ 4ï¼šVision API åˆ†æå¤±æ•—

**ç—‡ç‹€**ï¼šä¸Šå‚³åœ–ç‰‡å¾Œç„¡æ³•ç²å¾—åˆ†æçµæœ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèª `OPENAI_API_KEY` æœ‰æ•ˆ
- æª¢æŸ¥åœ–ç‰‡æ ¼å¼ï¼ˆåƒ…æ”¯æ´ `.png`, `.jpg`, `.jpeg`ï¼‰
- ç¢ºèªåœ–ç‰‡å¤§å° < 20MB

## ğŸ“ˆ ç›£æ§å»ºè­°

### é—œéµæŒ‡æ¨™

1. **API å›æ‡‰æ™‚é–“**
   - å°è©±ï¼š< 3 ç§’
   - æª”æ¡ˆä¸Šå‚³ï¼š< 5 ç§’
   - IPFS å°å­˜ï¼š< 10 ç§’

2. **æˆåŠŸç‡**
   - è¨˜æ†¶å„²å­˜ï¼š> 95%
   - æª”æ¡ˆä¸Šå‚³ï¼š> 98%
   - IPFS å°å­˜ï¼š> 90%ï¼ˆå« Pinata fallbackï¼‰

3. **è³‡æºä½¿ç”¨**
   - Redis é€£æ¥ï¼šç©©å®š
   - Supabase æŸ¥è©¢ï¼š< 500ms
   - OpenAI APIï¼š< 2 ç§’

### æ—¥èªŒç›£æ§

æª¢æŸ¥ Replit æ—¥èªŒä¸­çš„ï¼š
- âœ… "Redis å·²é€£æ¥ï¼ˆURL æ¨¡å¼ï¼‰"
- âœ… "Pinata API å·²é…ç½®"
- âœ… "æ‰€æœ‰ router æ›è¼‰å®Œæˆ"
- âš ï¸ ä»»ä½• ERROR ç´šåˆ¥æ—¥èªŒ

## ğŸ¨ è‡ªè¨‚åŸŸå

### Replit å¾Œç«¯åŸŸå

1. åœ¨ Replit éƒ¨ç½²è¨­å®šä¸­æ·»åŠ è‡ªè¨‚åŸŸå
2. æ·»åŠ  DNS CNAME è¨˜éŒ„ï¼š
   ```
   api.dreamground.net â†’ your-app.replit.app
   ```
3. æ›´æ–°å‰ç«¯ `VITE_API_URL` ç‚ºæ–°åŸŸå

### Cloudflare Pages å‰ç«¯åŸŸå

å·²é…ç½®ï¼š
- ä¸»åŸŸåï¼š`https://ai.dreamground.net`
- å‚™ç”¨åŸŸåï¼š`https://ai2.dreamground.net`

## ğŸš€ å¿«é€Ÿå‘½ä»¤åƒè€ƒ

```bash
# æœ¬åœ°é–‹ç™¼ï¼ˆå¾Œç«¯ï¼‰
python main.py

# æœ¬åœ°é–‹ç™¼ï¼ˆå‰ç«¯ï¼‰
cd frontend && npm run dev

# æ§‹å»ºå‰ç«¯ï¼ˆåœ¨ Cloudflare Pages è‡ªå‹•åŸ·è¡Œï¼‰
cd frontend && npm run build

# æ¸¬è©¦å¥åº·æª¢æŸ¥
curl https://your-app.replit.app/health

# æŸ¥çœ‹ Replit æ—¥èªŒ
# åœ¨ Replit æ§åˆ¶å° â†’ Logs æ¨™ç±¤
```

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼ŒæŒ‰ä»¥ä¸‹é †åºæª¢æŸ¥ï¼š

1. **Replit æ—¥èªŒ**ï¼šæŸ¥çœ‹éŒ¯èª¤è¨Šæ¯
2. **å¥åº·ç«¯é»**ï¼š`/health` ç¢ºèªæœå‹™ç‹€æ…‹
3. **ç€è¦½å™¨æ§åˆ¶å°**ï¼šæª¢æŸ¥å‰ç«¯éŒ¯èª¤
4. **Supabase å„€è¡¨æ¿**ï¼šç¢ºèªè³‡æ–™åº«é€£æ¥
5. **Redis ç‹€æ…‹**ï¼šç¢ºèª Upstash æ­£å¸¸

---

**éƒ¨ç½²æ™‚é–“**ï¼š2025-11-01  
**ç‰ˆæœ¬**ï¼šv1.0.1 (Phase 3)  
**æ¶æ§‹**ï¼šå‰å¾Œç«¯åˆ†é›¢ï¼ˆCloudflare Pages + Replitï¼‰  
**ç‹€æ…‹**ï¼šâœ… ç”Ÿç”¢å°±ç·’
