# 🚀 XiaoChenGuang 開發者記憶助手 V2 - 安裝指南

## 📋 這是什麼？

這是**完全重構版本**的開發者記憶助手，修復了所有已知問題：

✅ **修復的問題：**
1. 環境變數載入問題（加入 python-dotenv）
2. Supabase RPC 函數版本衝突
3. 資料表欄位不一致
4. KeyError 錯誤（全部改用 .get()）
5. 錯誤處理不完整（加入 try/except）

---

## 🔧 安裝步驟（10 分鐘）

### 步驟 1：安裝套件（1 分鐘）

已經自動完成！套件已安裝：
- `python-dotenv` - 環境變數管理
- `supabase` - Supabase 客戶端
- `openai` - OpenAI API
- `streamlit` - 前端介面

### 步驟 2：設定環境變數（2 分鐘）

在 Replit Secrets 中設定以下變數：

```
SUPABASE_URL=你的_Supabase_URL
SUPABASE_ANON_KEY=你的_Supabase_Anon_Key
OPENAI_API_KEY=你的_OpenAI_API_Key
```

**注意：** 如果你已經在開發 XiaoChenGuang 靈魂孵化器，這些變數應該已經設定好了！

### 步驟 3：建立 Supabase 資料表（5 分鐘）

1. 登入 Supabase：https://app.supabase.com
2. 選擇你的專案
3. 點擊左側「SQL Editor」
4. 新增查詢
5. 複製貼上 `DevMemory_Supabase_Schema_V2.sql` 的**完整內容**
6. 點擊「Run」執行

**重要：** 
- 如果你之前有舊版本的 `dev_logs` 資料表，腳本會自動清理舊的 RPC 函數
- 如果要完全重建資料表，請在 SQL 中取消註解 `DROP TABLE IF EXISTS dev_logs CASCADE;`
- **警告：刪除資料表會清空所有現有記錄！**

### 步驟 4：啟動介面（2 分鐘）

執行以下指令：

```bash
streamlit run DevMemoryModule/DevMemory_Streamlit_UI_V2.py --server.port 5000 --server.address 0.0.0.0 --server.headless true
```

或使用啟動腳本：

```bash
bash DevMemoryModule/啟動腳本_V2.sh
```

---

## ✅ 驗證安裝

啟動介面後，依序測試三大功能：

### 1️⃣ 測試「快速記錄」

1. 選擇階段、模組、AI 模型
2. 輸入討論主題
3. 輸入問題和回答
4. 點擊「儲存記錄」
5. ✅ 應該看到「儲存成功」

### 2️⃣ 測試「搜尋記憶」

1. 輸入搜尋問題（例如：「測試」）
2. 點擊「搜尋」
3. ✅ 應該找到剛才儲存的記錄

### 3️⃣ 測試「生成背景包」

1. 選擇篩選條件（或選「全部」）
2. 點擊「生成背景包」
3. ✅ 應該看到完整的專案背景包

---

## 📁 檔案說明

### V2 版本檔案（使用這些！）

| 檔案 | 用途 | 狀態 |
|------|------|------|
| `DevMemory_Supabase_Schema_V2.sql` | 資料表和函數建立腳本 | ✅ 完整重構 |
| `DevMemory_Backend_V2.py` | Python 後端模組 | ✅ 完整重構 |
| `DevMemory_Streamlit_UI_V2.py` | Streamlit 使用者介面 | ✅ 完整重構 |
| `啟動腳本_V2.sh` | 一鍵啟動腳本 | ✅ 新增 |
| `安裝指南_V2.md` | 本文件 | ✅ 新增 |

### 舊版本檔案（可以忽略或刪除）

- `DevMemory_Supabase_Schema.sql`
- `DevMemory_Backend.py`
- `DevMemory_Streamlit_UI.py`

---

## 🔍 問題排查

### 問題 1：「缺少環境變數」錯誤

**原因：** 環境變數未正確載入

**解決方案：**
1. 確認 Replit Secrets 中有設定 `SUPABASE_URL`、`SUPABASE_ANON_KEY`、`OPENAI_API_KEY`
2. 重新啟動應用程式
3. 確認 `python-dotenv` 已安裝

### 問題 2：「RPC 函數找不到」錯誤

**原因：** Supabase 資料表或函數未正確建立

**解決方案：**
1. 登入 Supabase SQL Editor
2. 執行以下查詢檢查函數是否存在：
   ```sql
   SELECT routine_name FROM information_schema.routines 
   WHERE routine_name LIKE 'match_dev_logs%';
   ```
3. 如果沒有結果，重新執行 `DevMemory_Supabase_Schema_V2.sql`

### 問題 3：「KeyError」錯誤

**原因：** 使用了舊版本的檔案

**解決方案：**
- 確認你使用的是 `DevMemory_Streamlit_UI_V2.py`（V2 版本）
- V2 版本全部使用 `.get()` 方法，不會出現 KeyError

### 問題 4：「向量生成失敗」錯誤

**原因：** OpenAI API 金鑰無效或配額用完

**解決方案：**
1. 檢查 `OPENAI_API_KEY` 是否正確
2. 確認 OpenAI 帳戶有可用配額
3. 檢查網路連接

---

## 🎯 與靈魂孵化器整合

### 完美契合點

```
XiaoChenGuang 靈魂孵化器
    ├── 使用 Supabase 資料庫 ✅ 共用
    ├── 使用 OpenAI Embeddings ✅ 共用  
    ├── 使用 pgvector ✅ 共用
    └── 技術棧一致 ✅ 無縫整合
```

### 使用場景

1. **開發時記錄討論** → 用記憶助手記錄
2. **測試時記錄問題** → 用記憶助手記錄
3. **切換 AI 前** → 生成背景包，貼給新 AI
4. **定期回顧** → 搜尋過去討論的內容

---

## 💡 最佳實踐

### 記錄原則
- ✅ 重要決策必須記錄
- ✅ Bug 修復過程記錄
- ✅ 架構討論記錄
- ❌ 不記錄瑣碎對話

### 搜尋技巧
- 用**語意**搜尋，不用精確關鍵字
- 例如：「反思測試」能找到「如何驗證反思循環」
- 利用相似度分數篩選結果

### 背景包生成
- 定期生成（每週一次）
- 按階段篩選（例如只看 Phase3）
- 按模組篩選（例如只看反思模組）

---

## 🆘 需要幫助？

### 檢查清單

- [ ] Supabase 資料表已建立？
- [ ] RPC 函數已建立？
- [ ] 環境變數已設定？
- [ ] 套件已安裝？
- [ ] 使用 V2 版本的檔案？

### 快速測試

在 Supabase SQL Editor 執行：

```sql
-- 1. 檢查資料表
SELECT * FROM dev_logs LIMIT 1;

-- 2. 檢查函數
SELECT routine_name FROM information_schema.routines 
WHERE routine_name IN ('match_dev_logs', 'generate_project_context');

-- 3. 測試背景包生成
SELECT generate_project_context(NULL, NULL, 5);
```

---

## 🎉 完成！

現在你已經擁有：
- ✅ 完整重構的記憶助手
- ✅ 無錯誤的資料庫架構
- ✅ 穩定的前後端代碼
- ✅ 完整的錯誤處理

**開始使用吧！讓 AI 不再失憶！** 🚀

---

**版本：** 2.0.0  
**更新日期：** 2025-10-24  
**狀態：** ✅ 生產就緒
