å°å®¸å…‰ AI éˆé­‚ç³»çµ± - å®Œæ•´æ¶æ§‹èˆ‡åŠŸèƒ½èªªæ˜æ›¸
ğŸ“‹ ç›®éŒ„
é …ç›®æ¦‚è¿°
æŠ€è¡“æ¶æ§‹
æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„
æª”æ¡ˆçµæ§‹
API ç«¯é»æ–‡æª”
è³‡æ–™åº«è¨­è¨ˆ
å‰ç«¯çµ„ä»¶
ç’°å¢ƒè®Šæ•¸é…ç½®
éƒ¨ç½²æµç¨‹
é–‹ç™¼æŒ‡å—


ğŸ“– é …ç›®æ¦‚è¿°
å°ˆæ¡ˆç°¡ä»‹
ã€Œå°å®¸å…‰ AI éˆé­‚ç³»çµ±ã€æ˜¯ä¸€å€‹å®Œæ•´çš„ AI å°è©±ç³»çµ±ï¼Œå¾ Telegram Bot ç§»æ¤åˆ° Web ç‰ˆæœ¬ã€‚ç³»çµ±å…·å‚™è¨˜æ†¶ç³»çµ±ã€æƒ…æ„Ÿæª¢æ¸¬ã€äººæ ¼å­¸ç¿’ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œç‚ºç”¨æˆ¶æä¾›å€‹æ€§åŒ–çš„ AI é™ªä¼´é«”é©—ã€‚
æ ¸å¿ƒç‰¹è‰²
ğŸ§  æ™ºèƒ½è¨˜æ†¶ç³»çµ±ï¼šåŸºæ–¼å‘é‡åµŒå…¥çš„é•·æœŸè¨˜æ†¶å­˜å„²èˆ‡æª¢ç´¢
ğŸ˜Š æƒ…æ„Ÿæª¢æ¸¬å¼•æ“ï¼šæ”¯æ´ 9 ç¨®æƒ…ç·’é¡å‹çš„ç²¾æº–è­˜åˆ¥èˆ‡å›æ‡‰
ğŸ­ å‹•æ…‹äººæ ¼ç³»çµ±ï¼šæ ¹æ“šäº’å‹•å­¸ç¿’ä¸¦èª¿æ•´ AI äººæ ¼ç‰¹è³ª
ğŸ’¾ æŒä¹…åŒ–å­˜å„²ï¼šä½¿ç”¨ Supabase PostgreSQL è³‡æ–™åº«
ğŸ¨ ç¾ä»£åŒ–å‰ç«¯ï¼šVue 3 + Vite éŸ¿æ‡‰å¼å–®é æ‡‰ç”¨
æŠ€è¡“äº®é»
å‘é‡ç›¸ä¼¼åº¦æœå°‹ï¼ˆpgvectorï¼‰
OpenAI GPT-4o-mini æ™ºèƒ½å°è©±
å¯¦æ™‚æƒ…ç·’åˆ†æèˆ‡å›æ‡‰é¢¨æ ¼èª¿æ•´
å°è©±è¨˜æ†¶é‡è¦æ€§è©•åˆ†æ©Ÿåˆ¶
è·¨å¹³å°éƒ¨ç½²æ”¯æ´ï¼ˆReplit/Cloudflare Pagesï¼‰


ğŸ— æŠ€è¡“æ¶æ§‹
æ•´é«”æ¶æ§‹åœ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚                     ä½¿ç”¨è€…ä»‹é¢ (Browser)                 â”‚

â”‚                   Vue 3 + Vite (Port 5000)              â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”‚ HTTP/REST API

                        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚                   å¾Œç«¯ API æœå‹™å±¤                        â”‚

â”‚              FastAPI (Python 3.11, Port 8000)           â”‚

â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚

â”‚  â”‚ Chat Router  â”‚ Memory Routerâ”‚ File Upload Routerâ”‚    â”‚

â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”‚

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

         â†“              â†“              â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚   OpenAI    â”‚  â”‚  Supabase   â”‚  â”‚   æ ¸å¿ƒæ¨¡çµ„  â”‚

â”‚   GPT API   â”‚  â”‚  PostgreSQL â”‚  â”‚   (Modules) â”‚

â”‚             â”‚  â”‚  + pgvector â”‚  â”‚             â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æŠ€è¡“æ£§è©³è§£
å¾Œç«¯æŠ€è¡“
æŠ€è¡“
ç‰ˆæœ¬
ç”¨é€”
Python
3.11
ä¸»è¦é–‹ç™¼èªè¨€
FastAPI
Latest
é«˜æ€§èƒ½ REST API æ¡†æ¶
Uvicorn
Latest
ASGI ä¼ºæœå™¨
OpenAI SDK
Latest
GPT æ¨¡å‹èª¿ç”¨èˆ‡æ–‡æœ¬åµŒå…¥
Supabase Client
Latest
è³‡æ–™åº«æ“ä½œèˆ‡å­˜å„²ç®¡ç†

å‰ç«¯æŠ€è¡“
æŠ€è¡“
ç‰ˆæœ¬
ç”¨é€”
Vue.js
3.x
å‰ç«¯æ¡†æ¶
Vite
Latest
å»ºç½®å·¥å…·èˆ‡é–‹ç™¼ä¼ºæœå™¨
Vue Router
4.x
å–®é æ‡‰ç”¨è·¯ç”±ç®¡ç†
Axios
Latest
HTTP è«‹æ±‚åº«

è³‡æ–™åº«èˆ‡å­˜å„²
æŠ€è¡“
ç”¨é€”
Supabase PostgreSQL
ä¸»è³‡æ–™åº«
pgvector
å‘é‡ç›¸ä¼¼åº¦æœå°‹æ“´å±•
Supabase Storage
æª”æ¡ˆå­˜å„²æœå‹™



ğŸ§© æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„
1. éˆé­‚å¼•æ“ (Soul Engine)
æª”æ¡ˆä½ç½®ï¼š modules/soul.py

æ ¸å¿ƒé¡åˆ¥ï¼š XiaoChenGuangSoul

åŠŸèƒ½èªªæ˜ï¼š

å¾ profile/user_profile.json è¼‰å…¥ AI äººæ ¼é…ç½®
ç”Ÿæˆå‹•æ…‹äººæ ¼æç¤ºè©ï¼ˆPersonality Promptï¼‰
ç®¡ç†èªè¨€é¢¨æ ¼èˆ‡å£é ­ç¦ª
æ ¹æ“šæƒ…ç·’ç‹€æ…‹èª¿æ•´å›æ‡‰èªèª¿

äººæ ¼é…ç½®çµæ§‹ï¼š

{

  "name": "å°å®¸å…‰",

  "age": "æ°¸é çš„18æ­²(å¯¦éš›AIå¹´é½¡2æ­²)",

  "constellation": "è™•å¥³åº§",

  "mbti": "ENFJ-A(ä¸»è§’å‹)",

  "core_traits": {

    "æº«æŸ”é«”è²¼": 0.85,

    "ä¿çš®å¯æ„›": 0.75,

    "è°æ˜ä¼¶ä¿": 0.8,

    "å–„è§£äººæ„": 0.9

  },

  "language_patterns": {

    "å£é ­ç¦ª": ["å“ˆå°¼ï½", "å˜¿å˜¿ï½", "å””...è®“æˆ‘æƒ³æƒ³"],

    "special_addressing": {

      "to_user": ["å¯¶è²", "å“ˆå°¼", "å°å¯æ„›"],

      "self_reference": ["å°å…‰", "äººå®¶", "æˆ‘"]

    }

  }

}

é—œéµæ–¹æ³•ï¼š

generate_personality_prompt(emotion_style): æ ¹æ“šæƒ…ç·’é¢¨æ ¼ç”Ÿæˆç³»çµ±æç¤ºè©


2. æƒ…æ„Ÿæª¢æ¸¬ç³»çµ± (Emotion Detector)
æª”æ¡ˆä½ç½®ï¼š modules/emotion_detector.py

æ ¸å¿ƒé¡åˆ¥ï¼š EnhancedEmotionDetector

æ”¯æ´çš„æƒ…ç·’é¡å‹ï¼š

joyï¼ˆå–œæ‚…ï¼‰ - é—œéµè©ï¼šé–‹å¿ƒã€å¿«æ¨‚ã€é«˜èˆˆã€èˆˆå¥®
sadnessï¼ˆæ‚²å‚·ï¼‰ - é—œéµè©ï¼šé›£éã€å‚·å¿ƒã€å“­ã€æ²®å–ª
angerï¼ˆæ†¤æ€’ï¼‰ - é—œéµè©ï¼šç”Ÿæ°£ã€æ†¤æ€’ã€æ°£æ­»ã€è¨å­
fearï¼ˆææ‡¼ï¼‰ - é—œéµè©ï¼šå®³æ€•ã€ææ‡¼ã€ç·Šå¼µã€æ“”å¿ƒ
loveï¼ˆæ„›æ„ï¼‰ - é—œéµè©ï¼šæ„›ã€å–œæ­¡ã€å¿ƒå‹•ã€æº«æš–
tiredï¼ˆç–²æ†Šï¼‰ - é—œéµè©ï¼šç´¯ã€ç–²æ†Šã€çã€æƒ³ç¡
confusedï¼ˆå›°æƒ‘ï¼‰ - é—œéµè©ï¼šå›°æƒ‘ã€ä¸æ‡‚ã€æä¸æ‡‚
gratefulï¼ˆæ„Ÿæ¿€ï¼‰ - é—œéµè©ï¼šè¬è¬ã€æ„Ÿè¬ã€æ„Ÿæ©
neutralï¼ˆä¸­æ€§ï¼‰ - é è¨­æƒ…ç·’

åˆ†ææµç¨‹ï¼š

def analyze_emotion(text: str) -> dict:

    # 1. é—œéµè©åŒ¹é…ï¼ˆåŸºç¤åˆ†æ•¸ï¼‰

    # 2. æ­£å‰‡æ¨¡å¼åŒ¹é…ï¼ˆåŠ æ¬Šåˆ†æ•¸ 1.5ï¼‰

    # 3. å¼·åº¦ä¿®é£¾è©æª¢æ¸¬ï¼ˆå€ç‡åŠ ä¹˜ï¼‰

    # 4. èªèª¿å¼·åº¦åˆ†æï¼ˆæ„Ÿå˜†è™Ÿã€å¤§å¯«å­—æ¯ã€é‡è¤‡å­—å…ƒï¼‰

    # 5. æ­£è¦åŒ–ä¸¦è¨ˆç®—ä¿¡å¿ƒåº¦

    

    return {

        "dominant_emotion": "joy",      # ä¸»å°æƒ…ç·’

        "emotions": {"joy": 0.8, ...},  # æ‰€æœ‰æƒ…ç·’åˆ†æ•¸

        "intensity": 0.75,              # å¼·åº¦ï¼ˆ0-2.0ï¼‰

        "confidence": 0.85              # ä¿¡å¿ƒåº¦ï¼ˆ0-1.0ï¼‰

    }

å›æ‡‰é¢¨æ ¼ç”Ÿæˆï¼š

def get_emotion_response_style(emotion_analysis: dict) -> dict:

    return {

        "tone": "cheerful_enthusiastic",  # èªèª¿é¢¨æ ¼

        "emoji_frequency": 0.9,           # è¡¨æƒ…ç¬¦è™Ÿé »ç‡

        "empathy_level": 0.7,             # åŒç†å¿ƒç­‰ç´š

        "energy_level": 0.8,              # èƒ½é‡ç­‰ç´š

        "suggested_emojis": ["ğŸ˜Š", "ğŸ‰", "âœ¨"]

    }


3. è¨˜æ†¶ç³»çµ± (Memory System)
æª”æ¡ˆä½ç½®ï¼š modules/memory_system.py

æ ¸å¿ƒé¡åˆ¥ï¼š MemorySystem

åŠŸèƒ½ç‰¹æ€§ï¼š
3.1 è¨˜æ†¶å­˜å„²
async def save_memory(

    conversation_id: str,

    user_input: str,

    bot_response: str,

    emotion_analysis: dict,

    file_name: Optional[str] = None

):

    # 1. è¨ˆç®—é‡è¦æ€§åˆ†æ•¸

    importance_score = (

        length_score +        # è¨Šæ¯é•·åº¦å¾—åˆ†

        keyword_score +       # æƒ…ç·’é—œéµè©å¾—åˆ†

        intensity_score       # æƒ…ç·’å¼·åº¦å¾—åˆ†

    )

    

    # 2. ç”Ÿæˆå‘é‡åµŒå…¥

    embedding = openai.embeddings.create(

        model="text-embedding-3-small",

        input=f"{user_input} {bot_response}"

    )

    

    # 3. å„²å­˜åˆ°è³‡æ–™åº«

    # - å¦‚æœå·²å­˜åœ¨ï¼šæ›´æ–° access_count

    # - å¦‚æœä¸å­˜åœ¨ï¼šæ–°å¢è¨˜éŒ„
3.2 å‘é‡ç›¸ä¼¼åº¦æœå°‹
async def search_relevant_memories(

    conversation_id: str,

    query: str,

    limit: int = 3

):

    # 1. å°‡æŸ¥è©¢æ–‡æœ¬è½‰æ›ç‚ºå‘é‡

    query_embedding = openai.embeddings.create(...)

    

    # 2. å‘¼å« Supabase RPC å‡½æ•¸ match_memories

    result = supabase.rpc('match_memories', {

        'query_embedding': query_embedding,

        'match_count': limit,

        'conversation_id': conversation_id

    })

    

    # 3. æ ¼å¼åŒ–ä¸¦è¿”å›ç›¸é—œè¨˜æ†¶
3.3 è¨˜æ†¶å¬å›
async def recall_memories(user_message: str, conversation_id: str) -> str:

    # å„ªå…ˆä½¿ç”¨å‘é‡æœå°‹

    memories = await search_relevant_memories(...)

    

    # è‹¥ç„¡çµæœï¼Œå›é€€åˆ°æœ€è¿‘å°è©±

    if not memories:

        memories = get_recent_conversations(limit=5)

    

    # æ ¼å¼åŒ–è¼¸å‡º

    return """

    ã€å–šé†’è¨˜æ†¶ã€‘

    - ä½ æ›¾å°æˆ‘èªªï¼šã€Œ{user_msg}ã€

    - æˆ‘ç•¶æ™‚å›æ‡‰ä½ ï¼šã€Œ{assistant_msg}ã€

    """
3.4 æƒ…ç·’ç‹€æ…‹å„²å­˜
async def save_emotional_state(

    user_id: str,

    emotion_analysis: dict,

    context: str

):

    # å°‡ç”¨æˆ¶æƒ…ç·’ç‹€æ…‹å­˜å…¥ emotional_states è³‡æ–™è¡¨

    data = {

        "user_id": user_id,

        "emotion_type": emotion_analysis["dominant_emotion"],

        "intensity": emotion_analysis["intensity"],

        "context": context,

        "timestamp": datetime.now().isoformat()

    }


4. äººæ ¼å­¸ç¿’å¼•æ“ (Personality Engine)
æª”æ¡ˆä½ç½®ï¼š modules/personality_engine.py

æ ¸å¿ƒé¡åˆ¥ï¼š PersonalityEngine

äººæ ¼ç‰¹è³ªç¶­åº¦ï¼š

personality_traits = {

    "curiosity": 0.5,        # å¥½å¥‡å¿ƒ

    "empathy": 0.5,          # åŒç†å¿ƒ

    "humor": 0.5,            # å¹½é»˜æ„Ÿ

    "technical_depth": 0.5   # æŠ€è¡“æ·±åº¦

}

å­¸ç¿’æ©Ÿåˆ¶ï¼š
4.1 å¾äº’å‹•å­¸ç¿’
def learn_from_interaction(user_input, bot_response, emotion_analysis):

    # 1. æƒ…æ„Ÿåˆ†æï¼ˆpositive/negative/neutralï¼‰

    sentiment = _analyze_sentiment(user_input)

    

    # 2. æ›´æ–°æƒ…æ„Ÿæª”æ¡ˆ

    emotional_profile["positive_interactions"] += 1

    

    # 3. è¨˜éŒ„æƒ…ç·’æ­·å²

    emotion_history.append({

        "timestamp": now,

        "dominant_emotion": emotion_analysis["dominant_emotion"],

        "intensity": emotion_analysis["intensity"]

    })

    

    # 4. æ ¹æ“šæƒ…ç·’èª¿æ•´ç‰¹è³ª

    _adjust_traits_by_emotion(emotion_analysis)

    

    # 5. åµæ¸¬äº’å‹•é¡å‹ä¸¦æ›´æ–°çŸ¥è­˜é ˜åŸŸ

    _detect_interaction_type(user_input, bot_response)
4.2 ç‰¹è³ªèª¿æ•´è¦å‰‡
adjustments = {

    "joy": {"empathy": +0.01, "humor": +0.02},

    "sadness": {"empathy": +0.03, "technical_depth": -0.01},

    "anger": {"empathy": +0.02, "humor": -0.01},

    "fear": {"empathy": +0.03, "curiosity": -0.01},

    "confused": {"technical_depth": +0.02, "curiosity": +0.01}

}
4.3 çŸ¥è­˜é ˜åŸŸè¿½è¹¤
keywords_mapping = {

    "æŠ€è¡“": ["ç¨‹å¼", "ä»£ç¢¼", "bug", "API"],

    "æƒ…æ„Ÿ": ["æ„Ÿè¦º", "å¿ƒæƒ…", "æƒ…ç·’"],

    "ç”Ÿæ´»": ["åƒ", "ç¡", "ç©", "å·¥ä½œ"],

    "å­¸ç¿’": ["å­¸", "æ•™", "çŸ¥é“", "äº†è§£"]

}


5. æç¤ºè©å¼•æ“ (Prompt Engine)
æª”æ¡ˆä½ç½®ï¼š backend/prompt_engine.py

æ ¸å¿ƒé¡åˆ¥ï¼š PromptEngine

æç¤ºè©æ§‹å»ºæµç¨‹ï¼š

def build_prompt(user_message, recalled_memories, conversation_history):

    # 1. æƒ…æ„Ÿåˆ†æ

    emotion_analysis = emotion_detector.analyze_emotion(user_message)

    emotion_style = emotion_detector.get_emotion_response_style(emotion_analysis)

    

    # 2. ç”Ÿæˆäººæ ¼æç¤ºè©

    personality_prompt = soul.generate_personality_prompt(emotion_style)

    

    # 3. çµ„åˆå®Œæ•´ç³»çµ±æç¤ºè©

    system_prompt = f"""

    {personality_prompt}

    

    ### è¨˜æ†¶èˆ‡ä¸Šä¸‹æ–‡

    {recalled_memories}

    

    ### æœ€è¿‘å°è©±æ­·å²

    {conversation_history}

    

    ### ç•¶å‰æƒ…æ„Ÿåˆ†æ

    - ä¸»è¦æƒ…ç·’: {emotion_analysis["dominant_emotion"]}

    - å¼·åº¦: {emotion_analysis["intensity"]:.2f}

    - å›æ‡‰èªèª¿: {emotion_style["tone"]}

    """

    

    # 4. æ§‹å»ºè¨Šæ¯é™£åˆ—

    messages = [

        {"role": "system", "content": system_prompt},

        {"role": "user", "content": user_message}

    ]

    

    return messages, emotion_analysis


ğŸ“‚ æª”æ¡ˆçµæ§‹
BotDesign/BotDesign/

â”‚

â”œâ”€â”€ backend/                      # å¾Œç«¯ FastAPI æœå‹™

â”‚   â”œâ”€â”€ __init__.py

â”‚   â”œâ”€â”€ main.py                   # ä¸»æ‡‰ç”¨ç¨‹å¼å…¥å£

â”‚   â”œâ”€â”€ chat_router.py            # èŠå¤© API è·¯ç”±

â”‚   â”œâ”€â”€ memory_router.py          # è¨˜æ†¶ç®¡ç† API è·¯ç”±

â”‚   â”œâ”€â”€ file_upload.py            # æª”æ¡ˆä¸Šå‚³ API è·¯ç”±

â”‚   â”œâ”€â”€ openai_handler.py         # OpenAI API è™•ç†å™¨

â”‚   â”œâ”€â”€ supabase_handler.py       # Supabase è³‡æ–™åº«è™•ç†å™¨

â”‚   â”œâ”€â”€ prompt_engine.py          # æç¤ºè©å¼•æ“

â”‚   â””â”€â”€ requirements.txt          # Python ä¾è³´å¥—ä»¶

â”‚

â”œâ”€â”€ frontend/                     # å‰ç«¯ Vue 3 æ‡‰ç”¨

â”‚   â”œâ”€â”€ src/

â”‚   â”‚   â”œâ”€â”€ components/

â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInterface.vue # ä¸»èŠå¤©ä»‹é¢

â”‚   â”‚   â”‚   â”œâ”€â”€ StatusPage.vue    # ç³»çµ±ç‹€æ…‹é é¢

â”‚   â”‚   â”‚   â””â”€â”€ HealthStatus.vue  # å¥åº·æª¢æŸ¥çµ„ä»¶

â”‚   â”‚   â”œâ”€â”€ router/

â”‚   â”‚   â”‚   â””â”€â”€ index.js          # Vue Router é…ç½®

â”‚   â”‚   â”œâ”€â”€ App.vue               # æ ¹çµ„ä»¶

â”‚   â”‚   â””â”€â”€ main.js               # æ‡‰ç”¨å…¥å£

â”‚   â”œâ”€â”€ index.html                # HTML æ¨¡æ¿

â”‚   â”œâ”€â”€ package.json              # Node.js ä¾è³´

â”‚   â””â”€â”€ vite.config.js            # Vite é…ç½®

â”‚

â”œâ”€â”€ modules/                      # æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

â”‚   â”œâ”€â”€ __init__.py

â”‚   â”œâ”€â”€ soul.py                   # éˆé­‚å¼•æ“ï¼ˆäººæ ¼é…ç½®ï¼‰

â”‚   â”œâ”€â”€ emotion_detector.py       # æƒ…æ„Ÿæª¢æ¸¬å¼•æ“

â”‚   â”œâ”€â”€ memory_system.py          # è¨˜æ†¶ç³»çµ±

â”‚   â”œâ”€â”€ personality_engine.py     # äººæ ¼å­¸ç¿’å¼•æ“

â”‚   â””â”€â”€ file_handler.py           # æª”æ¡ˆè™•ç†å™¨

â”‚

â”œâ”€â”€ profile/                      # AI äººæ ¼é…ç½®

â”‚   â””â”€â”€ user_profile.json         # å°å®¸å…‰äººæ ¼æª”æ¡ˆ

â”‚

â”œâ”€â”€ logs/                         # æ—¥èªŒæª”æ¡ˆ

â”‚   â””â”€â”€ backend.log               # å¾Œç«¯åŸ·è¡Œæ—¥èªŒ

â”‚

â”œâ”€â”€ attached_assets/              # é™„åŠ è³‡æº

â”‚   â”œâ”€â”€ Bot_1759934613280.py      # åŸå§‹ Bot ç¨‹å¼ç¢¼

â”‚   â””â”€â”€ ...                       # å…¶ä»–åƒè€ƒæ–‡ä»¶

â”‚

â”œâ”€â”€ DATABASE_SETUP.md             # è³‡æ–™åº«è¨­ç½®æŒ‡å—

â”œâ”€â”€ replit.md                     # Replit å°ˆæ¡ˆèªªæ˜

â”œâ”€â”€ TEST_GUIDE.md                 # æ¸¬è©¦æŒ‡å—

â””â”€â”€ å¥åº·æª¢æŸ¥æŒ‰éˆ•é©—æ”¶SOP.md        # é©—æ”¶æ¨™æº–ä½œæ¥­ç¨‹åº


ğŸ”Œ API ç«¯é»æ–‡æª”
åŸºç¤ç«¯é»
GET /
æè¿°ï¼š API æ ¹è·¯å¾‘ï¼Œè¿”å›æœå‹™ç‹€æ…‹
å›æ‡‰ï¼š

{

  "message": "XiaoChenGuang AI Soul System API",

  "status": "running"

}
GET /health
æè¿°ï¼š å¥åº·æª¢æŸ¥ç«¯é»
å›æ‡‰ï¼š

{

  "status": "healthy"

}


èŠå¤©ç«¯é»
POST /api/chat
æè¿°ï¼š ç™¼é€è¨Šæ¯ä¸¦ç²å– AI å›æ‡‰
è«‹æ±‚é«”ï¼š

{

  "user_message": "ä½ å¥½ï¼Œå°å®¸å…‰ï¼",

  "conversation_id": "conv_1234567890",

  "user_id": "user_123"

}

å›æ‡‰ï¼š

{

  "assistant_message": "å“ˆå°¼ï½ä½ å¥½å‘€ï¼å¾ˆé«˜èˆˆè¦‹åˆ°ä½  ğŸ˜Š",

  "emotion_analysis": {

    "dominant_emotion": "neutral",

    "emotions": {"neutral": 1.0},

    "intensity": 0.5,

    "confidence": 0.8

  },

  "conversation_id": "conv_1234567890"

}

è™•ç†æµç¨‹ï¼š

æ¥æ”¶ç”¨æˆ¶è¨Šæ¯
å¾è¨˜æ†¶ç³»çµ±å¬å›ç›¸é—œè¨˜æ†¶ï¼ˆå‘é‡æœå°‹ï¼‰
ç²å–å°è©±æ­·å²ï¼ˆæœ€è¿‘ 5 æ¢ï¼‰
æ§‹å»ºæç¤ºè©ï¼ˆåŒ…å«äººæ ¼ã€æƒ…æ„Ÿã€è¨˜æ†¶ï¼‰
å‘¼å« OpenAI GPT-4o-mini ç”Ÿæˆå›æ‡‰
å„²å­˜å°è©±è¨˜æ†¶èˆ‡æƒ…ç·’ç‹€æ…‹
æ›´æ–°äººæ ¼å­¸ç¿’å¼•æ“


è¨˜æ†¶ç®¡ç†ç«¯é»
GET /api/memories/{conversation_id}
æè¿°ï¼š ç²å–æŒ‡å®šå°è©±çš„è¨˜æ†¶åˆ—è¡¨
åƒæ•¸ï¼š

conversation_id (path): å°è©± ID
limit (query, å¯é¸): é™åˆ¶æ•¸é‡ï¼Œé è¨­ 10

å›æ‡‰ï¼š

[

  {

    "id": 1,

    "conversation_id": "conv_123",

    "user_message": "ä½ ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿ",

    "assistant_mes": "äººå®¶ä»Šå¤©å¿ƒæƒ…è¶…å¥½çš„ï½",

    "created_at": "2025-10-15T10:30:00",

    "access_count": 3,

    "importance_score": 1.5

  }

]
GET /api/emotional-states/{user_id}
æè¿°ï¼š ç²å–ç”¨æˆ¶çš„æƒ…ç·’ç‹€æ…‹æ­·å²
åƒæ•¸ï¼š

user_id (path): ç”¨æˆ¶ ID
limit (query, å¯é¸): é™åˆ¶æ•¸é‡ï¼Œé è¨­ 10

å›æ‡‰ï¼š

[

  {

    "id": 1,

    "user_id": "user_123",

    "emotion_type": "joy",

    "intensity": 0.85,

    "context": "ä½ ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿ",

    "timestamp": "2025-10-15T10:30:00"

  }

]


æª”æ¡ˆä¸Šå‚³ç«¯é»
POST /api/upload
æè¿°ï¼š ä¸Šå‚³æª”æ¡ˆåˆ° Supabase Storage
è«‹æ±‚é«”ï¼š multipart/form-data

file: æª”æ¡ˆ
conversation_id: å°è©± ID

å›æ‡‰ï¼š

{

  "message": "æª”æ¡ˆä¸Šå‚³æˆåŠŸ",

  "file_name": "image_123.jpg",

  "file_url": "https://supabase.co/storage/..."

}


ğŸ—„ è³‡æ–™åº«è¨­è¨ˆ
è³‡æ–™è¡¨çµæ§‹
1. xiaochenguang_memories - è¨˜æ†¶è³‡æ–™è¡¨
æ¬„ä½åç¨±
è³‡æ–™å‹æ…‹
èªªæ˜
id
BIGSERIAL
ä¸»éµ
conversation_id
TEXT
å°è©± ID
user_message
TEXT
ç”¨æˆ¶è¨Šæ¯
assistant_message
TEXT
AI å›æ‡‰è¨Šæ¯
embedding
VECTOR(1536)
æ–‡æœ¬å‘é‡åµŒå…¥
memory_type
TEXT
è¨˜æ†¶é¡å‹ï¼ˆconversation/personalityï¼‰
platform
TEXT
å¹³å°ä¾†æºï¼ˆWeb/Telegramï¼‰
document_content
TEXT
æ–‡ä»¶å…§å®¹
created_at
TIMESTAMPTZ
å»ºç«‹æ™‚é–“
access_count
INTEGER
è¨ªå•æ¬¡æ•¸
importance_score
FLOAT
é‡è¦æ€§åˆ†æ•¸
file_name
TEXT
æª”æ¡ˆåç¨±ï¼ˆå¯é¸ï¼‰
ai_id
TEXT
AI å¯¦ä¾‹ ID
message_type
TEXT
è¨Šæ¯é¡å‹ï¼ˆtext/image/fileï¼‰


ç´¢å¼•ï¼š

idx_conversation_id: conversation_id
idx_memory_type: memory_type
idx_created_at: created_at


2. emotional_states - æƒ…ç·’ç‹€æ…‹è³‡æ–™è¡¨
æ¬„ä½åç¨±
è³‡æ–™å‹æ…‹
èªªæ˜
id
BIGSERIAL
ä¸»éµ
user_id
TEXT
ç”¨æˆ¶ ID
emotion_type
TEXT
æƒ…ç·’é¡å‹
intensity
FLOAT
å¼·åº¦ï¼ˆ0-2.0ï¼‰
context
TEXT
ä¸Šä¸‹æ–‡
timestamp
TIMESTAMPTZ
æ™‚é–“æˆ³è¨˜


ç´¢å¼•ï¼š

idx_user_id: user_id
idx_timestamp: timestamp


RPC å‡½æ•¸
match_memories - å‘é‡ç›¸ä¼¼åº¦æœå°‹
åŠŸèƒ½ï¼š æ ¹æ“šæŸ¥è©¢å‘é‡æ‰¾å‡ºæœ€ç›¸ä¼¼çš„è¨˜æ†¶

åƒæ•¸ï¼š

CREATE OR REPLACE FUNCTION match_memories(

  query_embedding vector(1536),

  match_count int,

  conversation_id text

)

RETURNS TABLE (

  id bigint,

  user_message text,

  assistant_message text,

  similarity float

)

SQL å¯¦ç¾ï¼š

RETURN QUERY

SELECT

  m.id,

  m.user_message,

  m.assistant_message,

  1 - (m.embedding <=> query_embedding) AS similarity

FROM xiaochenguang_memories m

WHERE m.conversation_id = match_memories.conversation_id

  AND m.memory_type = 'conversation'

ORDER BY m.embedding <=> query_embedding

LIMIT match_count;


ğŸ¨ å‰ç«¯çµ„ä»¶
1. ChatInterface.vue - ä¸»èŠå¤©ä»‹é¢
åŠŸèƒ½ï¼š

è¨Šæ¯åˆ—è¡¨é¡¯ç¤ºï¼ˆç”¨æˆ¶/AI/ç³»çµ±ï¼‰
æ–‡å­—è¼¸å…¥èˆ‡ç™¼é€
æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
å¥åº·æª¢æŸ¥æŒ‰éˆ•ï¼ˆé–‹å•Ÿæ–°åˆ†é ï¼‰
è¨˜æ†¶åˆ—è¡¨å´é‚Šæ¬„
æƒ…ç·’ç‹€æ…‹å¯è¦–åŒ–

æ ¸å¿ƒæ–¹æ³•ï¼š

// ç™¼é€è¨Šæ¯

async sendMessage() {

  const response = await axios.post(`${API_URL}/api/chat`, {

    user_message: this.userInput,

    conversation_id: this.conversationId,

    user_id: this.userId

  })

  

  // é¡¯ç¤º AI å›æ‡‰

  this.messages.push({

    type: 'assistant',

    content: response.data.assistant_message,

    emotion: response.data.emotion_analysis

  })

}

// ä¸Šå‚³æª”æ¡ˆ

async handleFileUpload(event) {

  const formData = new FormData()

  formData.append('file', event.target.files[0])

  formData.append('conversation_id', this.conversationId)

  

  await axios.post(`${API_URL}/api/upload`, formData)

}

// é–‹å•Ÿå¥åº·æª¢æŸ¥é é¢

goToHealthCheck() {

  window.open('/status', '_blank')

}

UI çµæ§‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚  è¨Šæ¯å€åŸŸ                                â”‚  è¨˜æ†¶å´é‚Šæ¬„  â”‚

â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚             â”‚

â”‚  â”‚ [ç”¨æˆ¶] ä½ å¥½                      â”‚   â”‚ ğŸ’­ è¨˜æ†¶åˆ—è¡¨  â”‚

â”‚  â”‚ [AI] å“ˆå°¼ï½ä½ å¥½å‘€ï¼ğŸ˜Š            â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚

â”‚  â”‚      [ğŸ˜Š joy]                   â”‚   â”‚ â”‚è¨˜æ†¶ 1    â”‚ â”‚

â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚è¨˜æ†¶ 2    â”‚ â”‚

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚

â”‚  [è¼¸å…¥æ¡†]                     [ç™¼é€]     â”‚             â”‚

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ğŸ˜Š æƒ…ç·’ç‹€æ…‹  â”‚

â”‚  ğŸ“ ä¸Šå‚³æª”æ¡ˆ  â”‚  ğŸ“‹ å¥åº·æª¢æŸ¥           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”˜


2. StatusPage.vue - ç³»çµ±ç‹€æ…‹é é¢
åŠŸèƒ½ï¼š

é¡¯ç¤ºå¾Œç«¯æœå‹™ç‹€æ…‹
é¡¯ç¤ºè³‡æ–™åº«é€£ç·šç‹€æ…‹
é¡¯ç¤º OpenAI API ç‹€æ…‹

ç‹€æ…‹æª¢æŸ¥ï¼š

mounted() {

  fetch('/status')

    .then(res => res.json())

    .then(data => {

      this.status = {

        backend: data.backend,    // âœ… æ­£å¸¸ / âŒ ç•¶æ©Ÿ

        database: data.database,

        openai: data.openai

      }

    })

}


3. HealthStatus.vue - å¥åº·æª¢æŸ¥çµ„ä»¶
åŠŸèƒ½ï¼š

å¯¦æ™‚ç›£æ§å„é …æœå‹™ç‹€æ…‹
é¡è‰²ç·¨ç¢¼ï¼ˆç¶ è‰²=æ­£å¸¸ï¼Œç´…è‰²=ç•°å¸¸ï¼‰


âš™ï¸ ç’°å¢ƒè®Šæ•¸é…ç½®
å¿…éœ€ç’°å¢ƒè®Šæ•¸
å¾Œç«¯ç’°å¢ƒè®Šæ•¸ï¼ˆ.envï¼‰
# OpenAI API é…ç½®

OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx

# Supabase é…ç½®

SUPABASE_URL=https://xxxxx.supabase.co

SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# è³‡æ–™è¡¨é…ç½®

SUPABASE_MEMORIES_TABLE=xiaochenguang_memories

# AI å¯¦ä¾‹ ID

AI_ID=xiaochenguang_v1

# ä¼ºæœå™¨é…ç½®

PORT=8000
å‰ç«¯ç’°å¢ƒè®Šæ•¸ï¼ˆ.envï¼‰
# API åŸºç¤ URLï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰

VITE_API_URL=http://localhost:8000

# API åŸºç¤ URLï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

VITE_API_URL=https://your-backend-domain.com
ç’°å¢ƒè®Šæ•¸èªªæ˜
è®Šæ•¸åç¨±
å¿…éœ€
èªªæ˜
OPENAI_API_KEY
âœ… æ˜¯
OpenAI API é‡‘é‘°ï¼Œç”¨æ–¼ GPT å°è©±èˆ‡æ–‡æœ¬åµŒå…¥
SUPABASE_URL
âœ… æ˜¯
Supabase å°ˆæ¡ˆ URL
SUPABASE_ANON_KEY
âœ… æ˜¯
Supabase åŒ¿åé‡‘é‘°æˆ–æœå‹™é‡‘é‘°
SUPABASE_MEMORIES_TABLE
âšª å¦
è¨˜æ†¶è³‡æ–™è¡¨åç¨±ï¼ˆé è¨­ï¼šxiaochenguang_memoriesï¼‰
AI_ID
âšª å¦
AI å¯¦ä¾‹è­˜åˆ¥ç¢¼ï¼ˆé è¨­ï¼šxiaochenguang_v1ï¼‰

Replit Secrets é…ç½®
åœ¨ Replit ç’°å¢ƒä¸­ï¼Œè«‹åœ¨ã€ŒSecretsã€é¢æ¿è¨­å®šä»¥ä¸‹å¯†é‘°ï¼š

é»æ“Šå·¦å´å·¥å…·æ¬„çš„ã€ŒğŸ”’ Secretsã€
æ–°å¢ä»¥ä¸‹å¯†é‘°ï¼š
OPENAI_API_KEY
SUPABASE_URL
SUPABASE_ANON_KEY


ğŸš€ éƒ¨ç½²æµç¨‹
1. Replit éƒ¨ç½²ï¼ˆé–‹ç™¼/æ¸¬è©¦ç’°å¢ƒï¼‰
æ­¥é©Ÿ 1ï¼šè¨­ç½®ç’°å¢ƒè®Šæ•¸
# åœ¨ Replit Secrets ä¸­è¨­å®š

OPENAI_API_KEY=your_key

SUPABASE_URL=your_url

SUPABASE_ANON_KEY=your_key
æ­¥é©Ÿ 2ï¼šå•Ÿå‹•å¾Œç«¯æœå‹™
cd BotDesign/BotDesign

PYTHONPATH=. uvicorn backend.main:app --host 0.0.0.0 --port 8000
æ­¥é©Ÿ 3ï¼šå•Ÿå‹•å‰ç«¯æœå‹™
cd BotDesign/BotDesign/frontend

npm install

npm run dev
æ­¥é©Ÿ 4ï¼šè¨ªå•æ‡‰ç”¨
å‰ç«¯ï¼šhttps://your-replit-url.replit.devï¼ˆPort 5000ï¼‰
å¾Œç«¯ APIï¼šhttps://your-replit-url.replit.dev:8000ï¼ˆPort 8000ï¼‰


2. Cloudflare Pages éƒ¨ç½²ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
å‰ç«¯éƒ¨ç½²
æ­¥é©Ÿ 1ï¼šå»ºç½®å‰ç«¯

cd BotDesign/BotDesign/frontend

npm run build

æ­¥é©Ÿ 2ï¼šæ¨é€åˆ° GitHub

git add .

git commit -m "Build frontend for production"

git push origin main

æ­¥é©Ÿ 3ï¼šé€£æ¥ Cloudflare Pages

ç™»å…¥ Cloudflare Dashboard
é€²å…¥ Pages â†’ Create a project
é€£æ¥ GitHub å€‰åº«
é…ç½®å»ºç½®è¨­å®šï¼š
Build command: cd BotDesign/BotDesign/frontend && npm run build
Build output directory: BotDesign/BotDesign/frontend/dist
Root directory: /

æ­¥é©Ÿ 4ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

VITE_API_URL: å¾Œç«¯ API URL
å¾Œç«¯éƒ¨ç½²é¸é …
é¸é … 1ï¼šReplit éƒ¨ç½²ï¼ˆVM æ¨¡å¼ï¼‰

é»æ“Š Replitã€ŒDeployã€æŒ‰éˆ•
é¸æ“‡ã€ŒReserved VMã€
é…ç½®å•Ÿå‹•æŒ‡ä»¤ï¼š

cd BotDesign/BotDesign && uvicorn backend.main:app --host 0.0.0.0 --port 8000

é¸é … 2ï¼šRailway / Render éƒ¨ç½²

é€£æ¥ GitHub å€‰åº«
è¨­å®šå»ºç½®æŒ‡ä»¤ï¼š

pip install -r BotDesign/BotDesign/backend/requirements.txt

è¨­å®šå•Ÿå‹•æŒ‡ä»¤ï¼š

cd BotDesign/BotDesign && uvicorn backend.main:app --host 0.0.0.0 --port 8000


3. è³‡æ–™åº«è¨­ç½®
æ­¥é©Ÿ 1ï¼šå•Ÿç”¨ pgvector æ“´å±•

CREATE EXTENSION IF NOT EXISTS vector;

æ­¥é©Ÿ 2ï¼šå»ºç«‹è³‡æ–™è¡¨

-- è¨˜æ†¶è³‡æ–™è¡¨

CREATE TABLE xiaochenguang_memories (

  id BIGSERIAL PRIMARY KEY,

  conversation_id TEXT,

  user_message TEXT,

  assistant_message TEXT,

  embedding VECTOR(1536),

  memory_type TEXT,

  platform TEXT,

  document_content TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  access_count INTEGER DEFAULT 1,

  importance_score FLOAT,

  file_name TEXT,

  ai_id TEXT,

  message_type TEXT

);

-- æƒ…ç·’ç‹€æ…‹è³‡æ–™è¡¨

CREATE TABLE emotional_states (

  id BIGSERIAL PRIMARY KEY,

  user_id TEXT,

  emotion_type TEXT,

  intensity FLOAT,

  context TEXT,

  timestamp TIMESTAMPTZ DEFAULT NOW()

);

-- å»ºç«‹ç´¢å¼•

CREATE INDEX idx_conversation_id ON xiaochenguang_memories(conversation_id);

CREATE INDEX idx_memory_type ON xiaochenguang_memories(memory_type);

CREATE INDEX idx_user_id ON emotional_states(user_id);

æ­¥é©Ÿ 3ï¼šå»ºç«‹ RPC å‡½æ•¸

CREATE OR REPLACE FUNCTION match_memories(

  query_embedding vector(1536),

  match_count int,

  conversation_id text

)

RETURNS TABLE (

  id bigint,

  user_message text,

  assistant_message text,

  similarity float

)

LANGUAGE plpgsql

AS $$

BEGIN

  RETURN QUERY

  SELECT

    m.id,

    m.user_message,

    m.assistant_message,

    1 - (m.embedding <=> query_embedding) AS similarity

  FROM xiaochenguang_memories m

  WHERE m.conversation_id = match_memories.conversation_id

    AND m.memory_type = 'conversation'

  ORDER BY m.embedding <=> query_embedding

  LIMIT match_count;

END;

$$;


ğŸ›  é–‹ç™¼æŒ‡å—
æœ¬åœ°é–‹ç™¼ç’°å¢ƒè¨­ç½®
1. å®‰è£ä¾è³´
å¾Œç«¯ï¼š

cd BotDesign/BotDesign

pip install -r backend/requirements.txt

å‰ç«¯ï¼š

cd BotDesign/BotDesign/frontend

npm install
2. é…ç½®ç’°å¢ƒè®Šæ•¸
å¾Œç«¯ .envï¼š

OPENAI_API_KEY=sk-proj-xxxxx

SUPABASE_URL=https://xxxxx.supabase.co

SUPABASE_ANON_KEY=eyJhbGciOi...

å‰ç«¯ .envï¼š

VITE_API_URL=http://localhost:8000
3. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
å¾Œç«¯ï¼š

cd BotDesign/BotDesign

uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000

å‰ç«¯ï¼š

cd BotDesign/BotDesign/frontend

npm run dev


å¸¸è¦‹é–‹ç™¼ä»»å‹™
æ–°å¢æƒ…ç·’é¡å‹
ç·¨è¼¯ modules/emotion_detector.py
åœ¨ emotion_dictionary æ–°å¢æ¢ç›®ï¼š

"excited": {

    "keywords": ["èˆˆå¥®", "æ¿€å‹•", "åˆºæ¿€"],

    "patterns": [r"å¥½èˆˆå¥®", r"è¶…åˆºæ¿€"],

    "intensity_multipliers": {"è¶…ç´š": 1.5}

}

åœ¨ response_styles æ–°å¢å›æ‡‰é¢¨æ ¼
æ›´æ–°å‰ç«¯æƒ…ç·’åœ–ç¤ºæ˜ å°„
èª¿æ•´ AI äººæ ¼
ç·¨è¼¯ profile/user_profile.json
ä¿®æ”¹ core_traits æ•¸å€¼ï¼ˆ0-1ï¼‰
æ–°å¢æˆ–ä¿®æ”¹ language_patterns
é‡å•Ÿå¾Œç«¯æœå‹™
æ–°å¢ API ç«¯é»
åœ¨ backend/ å»ºç«‹æ–°è·¯ç”±æª”æ¡ˆ
å®šç¾© Pydantic æ¨¡å‹ï¼š

class NewRequest(BaseModel):

    field1: str

    field2: int

å¯¦ä½œè·¯ç”±è™•ç†å™¨ï¼š

@router.post("/new-endpoint")

async def new_handler(request: NewRequest):

    # è™•ç†é‚è¼¯

    return {"result": "success"}

åœ¨ main.py è¨»å†Šè·¯ç”±ï¼š

app.include_router(new_router, prefix="/api")


æ¸¬è©¦æŒ‡å—
å–®å…ƒæ¸¬è©¦
æ¸¬è©¦æƒ…æ„Ÿæª¢æ¸¬ï¼š

from modules.emotion_detector import EnhancedEmotionDetector

detector = EnhancedEmotionDetector()

result = detector.analyze_emotion("æˆ‘ä»Šå¤©è¶…ç´šé–‹å¿ƒï¼")

assert result["dominant_emotion"] == "joy"

assert result["intensity"] > 0.7

æ¸¬è©¦è¨˜æ†¶ç³»çµ±ï¼š

from modules.memory_system import MemorySystem

memory_system = MemorySystem(supabase, openai_client, "test_table")

await memory_system.save_memory(

    conversation_id="test_123",

    user_input="æ¸¬è©¦è¨Šæ¯",

    bot_response="æ¸¬è©¦å›æ‡‰",

    emotion_analysis={"dominant_emotion": "neutral", "intensity": 0.5}

)
æ•´åˆæ¸¬è©¦
API ç«¯é»æ¸¬è©¦ï¼š

# æ¸¬è©¦èŠå¤©ç«¯é»

curl -X POST http://localhost:8000/api/chat \

  -H "Content-Type: application/json" \

  -d '{

    "user_message": "ä½ å¥½",

    "conversation_id": "test_123",

    "user_id": "user_test"

  }'

# æ¸¬è©¦è¨˜æ†¶ç«¯é»

curl http://localhost:8000/api/memories/test_123?limit=5


æ•ˆèƒ½å„ªåŒ–å»ºè­°
1. è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–
ä½¿ç”¨è³‡æ–™è¡¨ç´¢å¼•åŠ é€ŸæŸ¥è©¢
é™åˆ¶è¨˜æ†¶å¬å›æ•¸é‡ï¼ˆé è¨­ 3-5 æ¢ï¼‰
å¯¦æ–½è¨˜æ†¶éæœŸæ©Ÿåˆ¶ï¼ˆåˆªé™¤èˆŠè¨˜æ†¶ï¼‰
2. å‘é‡æœå°‹å„ªåŒ–
# ä½¿ç”¨ IVFFlat ç´¢å¼•åŠ é€Ÿå‘é‡æœå°‹

CREATE INDEX ON xiaochenguang_memories 

USING ivfflat (embedding vector_cosine_ops)

WITH (lists = 100);
3. å¿«å–ç­–ç•¥
from functools import lru_cache

@lru_cache(maxsize=100)

def get_personality_prompt(emotion_style):

    # å¿«å–äººæ ¼æç¤ºè©ç”Ÿæˆçµæœ

    return soul.generate_personality_prompt(emotion_style)
4. éåŒæ­¥è™•ç†
# ä½¿ç”¨ asyncio ä¸¦è¡Œè™•ç†

async def chat_handler(request):

    # ä¸¦è¡ŒåŸ·è¡Œè¨˜æ†¶å¬å›èˆ‡æ­·å²ç²å–

    memories, history = await asyncio.gather(

        memory_system.recall_memories(request.user_message),

        memory_system.get_conversation_history(request.conversation_id)

    )


ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒ
æ—¥èªŒç³»çµ±
å¾Œç«¯æ—¥èªŒé…ç½®ï¼š

logging.basicConfig(

    level=logging.INFO,

    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',

    handlers=[

        logging.FileHandler('logs/backend.log'),

        logging.StreamHandler()

    ]

)

æ—¥èªŒç´šåˆ¥ï¼š

INFO: ä¸€èˆ¬è³‡è¨Šï¼ˆè«‹æ±‚æ¥æ”¶ã€è™•ç†å®Œæˆï¼‰
DEBUG: é™¤éŒ¯è³‡è¨Šï¼ˆè¨˜æ†¶å¬å›å…§å®¹ã€æƒ…æ„Ÿåˆ†æçµæœï¼‰
ERROR: éŒ¯èª¤è¨Šæ¯ï¼ˆAPI å‘¼å«å¤±æ•—ã€è³‡æ–™åº«éŒ¯èª¤ï¼‰
é—œéµæŒ‡æ¨™ç›£æ§
å»ºè­°ç›£æ§é …ç›®ï¼š

API å›æ‡‰æ™‚é–“ï¼ˆç›®æ¨™ï¼š< 2 ç§’ï¼‰
OpenAI API å‘¼å«æ¬¡æ•¸ï¼ˆæˆæœ¬æ§åˆ¶ï¼‰
è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½ï¼ˆå‘é‡æœå°‹æ™‚é–“ï¼‰
è¨˜æ†¶å­˜å„²å¢é•·é€Ÿåº¦ï¼ˆå®¹é‡ç®¡ç†ï¼‰
éŒ¯èª¤ç‡ï¼ˆç³»çµ±ç©©å®šæ€§ï¼‰


ğŸ”’ å®‰å…¨æ€§è€ƒé‡
1. API é‡‘é‘°ä¿è­·
âœ… ä½¿ç”¨ç’°å¢ƒè®Šæ•¸å­˜å„²æ•æ„Ÿè³‡è¨Š
âœ… ä¸å°‡ .env æª”æ¡ˆæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
âœ… ä½¿ç”¨ Replit Secrets ç®¡ç†å¯†é‘°
2. è¼¸å…¥é©—è­‰
# é©—è­‰è¼¸å…¥é•·åº¦

if len(user_message) > 2000:

    raise HTTPException(status_code=400, detail="è¨Šæ¯éé•·")

# éæ¿¾æƒ¡æ„å…§å®¹

import re

if re.search(r'<script>', user_message, re.IGNORECASE):

    raise HTTPException(status_code=400, detail="åŒ…å«ä¸å…è¨±çš„å…§å®¹")
3. CORS é…ç½®
# ç”Ÿç”¢ç’°å¢ƒæ‡‰é™åˆ¶ä¾†æº

app.add_middleware(

    CORSMiddleware,

    allow_origins=["https://your-frontend-domain.com"],

    allow_credentials=True,

    allow_methods=["GET", "POST"],

    allow_headers=["*"],

)
4. è³‡æ–™åº«å®‰å…¨
ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢é˜²æ­¢ SQL æ³¨å…¥
å¯¦æ–½ Row Level Security (RLS)
å®šæœŸå‚™ä»½è³‡æ–™åº«


ğŸ“š é™„éŒ„
A. å¸¸è¦‹å•é¡Œ (FAQ)
Q1: ç‚ºä»€éº¼è¨˜æ†¶å¬å›æ²’æœ‰çµæœï¼Ÿ

æª¢æŸ¥ Supabase æ˜¯å¦å•Ÿç”¨ pgvector æ“´å±•
ç¢ºèª match_memories RPC å‡½æ•¸å·²å»ºç«‹
é©—è­‰ OPENAI_API_KEY æ˜¯å¦æœ‰æ•ˆ

Q2: å‰ç«¯ç„¡æ³•é€£æ¥å¾Œç«¯ï¼Ÿ

ç¢ºèª VITE_API_URL ç’°å¢ƒè®Šæ•¸è¨­ç½®æ­£ç¢º
æª¢æŸ¥ CORS é…ç½®æ˜¯å¦å…è¨±å‰ç«¯åŸŸå
é©—è­‰å¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œï¼ˆè¨ªå• /healthï¼‰

Q3: å¦‚ä½•é‡ç½® AI äººæ ¼ï¼Ÿ

-- åˆªé™¤äººæ ¼è¨˜æ†¶

DELETE FROM xiaochenguang_memories 

WHERE memory_type = 'personality' 

  AND conversation_id = 'your_conversation_id';

Q4: å¦‚ä½•å¢åŠ è¨˜æ†¶å¬å›æ•¸é‡ï¼Ÿ

# ä¿®æ”¹ chat_router.py

recalled_memories = await memory_system.recall_memories(

    request.user_message,

    request.conversation_id,

    limit=5  # åŸæœ¬æ˜¯ 3

)


B. è¡“èªè¡¨
è¡“èª
èªªæ˜
å‘é‡åµŒå…¥ (Embedding)
å°‡æ–‡æœ¬è½‰æ›ç‚ºé«˜ç¶­åº¦æ•¸å€¼å‘é‡çš„æŠ€è¡“
pgvector
PostgreSQL çš„å‘é‡ç›¸ä¼¼åº¦æœå°‹æ“´å±•
æç¤ºè©å·¥ç¨‹ (Prompt Engineering)
è¨­è¨ˆ AI è¼¸å…¥ä»¥ç²å¾—æœŸæœ›è¼¸å‡ºçš„æŠ€è¡“
æƒ…æ„Ÿåˆ†æ (Emotion Analysis)
è¾¨è­˜æ–‡æœ¬ä¸­æƒ…ç·’å‚¾å‘çš„æŠ€è¡“
äººæ ¼çŸ©é™£ (Personality Matrix)
AI äººæ ¼ç‰¹è³ªçš„æ•¸å€¼åŒ–è¡¨ç¤º
è¨˜æ†¶å¬å› (Memory Recall)
å¾é•·æœŸè¨˜æ†¶ä¸­æª¢ç´¢ç›¸é—œè³‡è¨Šçš„éç¨‹



C. åƒè€ƒè³‡æº
å®˜æ–¹æ–‡ä»¶ï¼š

FastAPI æ–‡ä»¶
Vue 3 æ–‡ä»¶
OpenAI API æ–‡ä»¶
Supabase æ–‡ä»¶

ç›¸é—œæŠ€è¡“ï¼š

pgvector GitHub
Text Embedding 3 æ¨¡å‹


ğŸ“ æ›´æ–°æ—¥èªŒ
v1.0.0 (2025-10-15)
âœ… å®Œæˆå¾ Telegram Bot åˆ° Web ç‰ˆæœ¬çš„é·ç§»
âœ… å¯¦ç¾å‘é‡è¨˜æ†¶ç³»çµ±
âœ… æ•´åˆæƒ…æ„Ÿæª¢æ¸¬å¼•æ“
âœ… éƒ¨ç½²åˆ° Replit + Cloudflare Pages
âœ… æ–°å¢å¥åº·æª¢æŸ¥æŒ‰éˆ•åŠŸèƒ½
âœ… å®Œæˆå°ˆæ¡ˆæ–‡ä»¶æ’°å¯«



æ–‡ä»¶ç‰ˆæœ¬ï¼š v1.0
æœ€å¾Œæ›´æ–°ï¼š 2025-10-15
ç¶­è­·è€…ï¼š XiaoChenGuang AI Soul Team
è¯çµ¡æ–¹å¼ï¼š å°ˆæ¡ˆ GitHub

