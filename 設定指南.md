# 🎯 語義記憶系統 - 超簡單設定指南

> 這份指南寫給「完全不懂程式」的人看。
> 只要照著步驟做，保證能用！

---

## 📋 需要準備的東西（3個）

在開始之前，你需要準備 **3 個東西**：

1. ✅ **Google 帳號的認證鑰匙**（一段文字）
2. ✅ **Google 試算表的 ID**（一串英文數字）
3. ✅ **安全密碼**（自己設定）

別擔心！下面會一步一步教你怎麼取得。

---

## 🔑 第一步：取得 Google 認證鑰匙

### 1-1. 開啟 Google Cloud 控制台

1. 用你的 Google 帳號登入
2. 前往：https://console.cloud.google.com/
3. 如果是第一次使用，會要你「建立專案」，就點「建立」

### 1-2. 啟用 Google Sheets API

1. 在左側選單找到「API 和服務」→ 點「資料庫」
2. 點上方的「+ 啟用 API 和服務」
3. 搜尋框輸入：`Google Sheets API`
4. 點進去，按「啟用」按鈕
5. 用同樣方式再啟用：`Google Drive API`

### 1-3. 建立服務帳號（機器人帳號）

1. 在左側選單找到「API 和服務」→ 點「憑證」
2. 點上方的「+ 建立憑證」→ 選「服務帳號」
3. 填寫資料：
   - **服務帳號名稱**：隨便取，例如 `memory-system`
   - **說明**：可以不填
4. 點「建立並繼續」
5. **角色選擇**：選「編輯者」（Editor）
6. 點「繼續」→ 點「完成」

### 1-4. 下載認證鑰匙

1. 在「憑證」頁面，找到剛才建立的服務帳號（有個機器人圖示）
2. 點服務帳號的**電子郵件地址**（長得像 xxx@xxx.iam.gserviceaccount.com）
3. 切換到「金鑰」分頁
4. 點「新增金鑰」→ 選「建立新的金鑰」
5. 選擇「JSON」格式
6. 點「建立」，會自動下載一個 `.json` 檔案

### 1-5. 打開 JSON 檔案

1. 用「記事本」或「文字編輯器」打開剛才下載的 `.json` 檔案
2. 你會看到一大段文字，像這樣：

```json
{
  "type": "service_account",
  "project_id": "你的專案ID",
  "private_key_id": "一串亂碼",
  "private_key": "-----BEGIN PRIVATE KEY-----\n更多亂碼\n-----END PRIVATE KEY-----\n",
  "client_email": "xxx@xxx.iam.gserviceaccount.com",
  ...
}
```

3. **全選複製**這整段文字（從 `{` 開頭到 `}` 結尾，一個字都不能少）
4. **先存在記事本裡**，等等會用到

---

## 📊 第二步：取得 Google 試算表 ID

### 2-1. 建立一個 Google 試算表

1. 前往：https://sheets.google.com/
2. 點「空白試算表」建立一個新的試算表
3. 給它取個名字，例如：`AI對話記錄`

### 2-2. 分享給服務帳號

⚠️ **這一步很重要！** 不做的話系統會無法寫入資料。

1. 點右上角的「共用」按鈕
2. 在「新增使用者或群組」欄位中，**貼上服務帳號的電子郵件**
   - 就是剛才看到的 `xxx@xxx.iam.gserviceaccount.com`
3. 權限選擇「編輯者」
4. **取消勾選**「通知使用者」（因為它是機器人，不用通知）
5. 點「傳送」或「共用」

### 2-3. 複製試算表 ID

1. 看一下網址列，長這樣：
   ```
   https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit
   ```

2. **複製中間那一大串英文數字**：`1a2b3c4d5e6f7g8h9i0j`
   - 就是 `/d/` 後面到 `/edit` 前面的部分

3. **先存在記事本裡**，等等會用到

---

## 🔐 第三步：設定安全密碼

這個密碼是用來保護你的對話紀錄的。

1. 隨便想一個密碼，例如：`my-super-secret-password-2024`
2. 或是用這個方法產生隨機密碼：
   - 前往：https://www.random.org/strings/
   - 點「Get Strings」
   - 複製產生的亂碼

3. **先存在記事本裡**，等等會用到

---

## ⚙️ 第四步：在 Replit 設定環境變數

現在要把剛才準備的 3 個東西，設定到系統裡。

### 4-1. 開啟 Secrets 設定

1. 在 Replit 專案中，找到左側工具列的「鎖頭圖示」（Secrets）
2. 點進去

### 4-2. 設定第 1 個 Secret：SERVICE_ACCOUNT_JSON

1. 點「+ New Secret」或「新增密鑰」
2. 填寫：
   - **Key（名稱）**：`SERVICE_ACCOUNT_JSON`（一個字都不能錯）
   - **Value（值）**：貼上剛才複製的**整個 JSON 內容**
     - 記得是從 `{` 到 `}` 完整的內容
     - 包含所有的引號、逗號、換行
3. 點「Add Secret」或「新增」

### 4-3. 設定第 2 個 Secret：SPREADSHEET_ID

1. 再點一次「+ New Secret」
2. 填寫：
   - **Key（名稱）**：`SPREADSHEET_ID`（一個字都不能錯）
   - **Value（值）**：貼上剛才複製的**試算表 ID**
     - 例如：`1a2b3c4d5e6f7g8h9i0j`
3. 點「Add Secret」或「新增」

### 4-4. 設定第 3 個 Secret：SESSION_SECRET

1. 再點一次「+ New Secret」
2. 填寫：
   - **Key（名稱）**：`SESSION_SECRET`（一個字都不能錯）
   - **Value（值）**：貼上剛才設定的**安全密碼**
     - 例如：`my-super-secret-password-2024`
3. 點「Add Secret」或「新增」

### 4-5. 確認設定

檢查一下，你應該有 **3 個 Secrets**：
- ✅ `SERVICE_ACCOUNT_JSON`
- ✅ `SPREADSHEET_ID`
- ✅ `SESSION_SECRET`

---

## 🎉 第五步：啟動系統

### 5-1. 點擊 Run 按鈕

1. 點 Replit 上方的「Run」按鈕（綠色播放鍵）
2. 等幾秒鐘，讓系統啟動

### 5-2. 測試系統

1. 右側會出現網頁預覽
2. 你應該會看到系統首頁
3. 如果看到錯誤頁面，回去檢查 3 個 Secrets 是否設定正確

---

## ✅ 完成！開始使用

恭喜！系統已經設定好了。

### 如何使用：

1. **建立新對話**：
   - 在首頁輸入對話名稱（例如：`專案討論`）
   - 點「建立新對話」

2. **延續對話**：
   - 輸入已存在的對話名稱
   - 點「延續已有對話」

3. **紀錄對話**：
   - 使用 API 端點紀錄你和 AI 的對話
   - 所有記錄都會自動存到 Google 試算表

---

## ❓ 常見問題

### Q1：出現「找不到 SERVICE_ACCOUNT_JSON」錯誤

**原因**：環境變數沒設定好

**解決**：
1. 回到 Secrets 設定
2. 確認有 `SERVICE_ACCOUNT_JSON` 這個名稱（一個字都不能錯）
3. 確認值是完整的 JSON（從 `{` 到 `}`）

### Q2：出現「Credentials.from_service_account_info() takes 2 positional arguments but 3 were given」錯誤

**原因**：這是舊版程式碼的 bug，現在已經修復了

**解決**：
1. 確保使用最新版的 `app.py`
2. 重新點「Run」按鈕

### Q3：出現「找不到工作表」錯誤

**原因**：試算表沒有分享給服務帳號

**解決**：
1. 打開你的 Google 試算表
2. 點「共用」
3. 新增服務帳號的電子郵件（`xxx@xxx.iam.gserviceaccount.com`）
4. 權限選「編輯者」

### Q4：試算表 ID 在哪裡找？

在試算表的網址中：
```
https://docs.google.com/spreadsheets/d/【這一段就是ID】/edit
```

### Q5：JSON 格式錯誤怎麼辦？

1. 重新下載 JSON 檔案
2. 用記事本打開（不要用 Word）
3. 全選複製（Ctrl+A → Ctrl+C）
4. 完整貼到 `SERVICE_ACCOUNT_JSON` 的值

---

## 📞 需要幫助？

如果按照步驟做還是有問題：

1. **檢查 Secrets**：確認 3 個都設定正確
2. **檢查試算表分享**：確認服務帳號有權限
3. **重新啟動**：點「Stop」再點「Run」
4. **查看錯誤訊息**：截圖錯誤頁面，可以幫助找出問題

---

**最後提醒**：

- ⚠️ 不要把 JSON 金鑰分享給別人
- ⚠️ 不要把 Secrets 的內容貼到網路上
- ✅ 定期更換安全密碼
- ✅ 不用的服務帳號要刪除

**祝使用愉快！** 🚀
